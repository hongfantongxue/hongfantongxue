<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  <meta name="description" content="记录技术点滴">
  
  <title>
    
    个人博客
  </title>
  
    <link rel="shortcut icon" href="/favicon.ico">
    
  
<link rel="stylesheet" href="/css/style.css">

  
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <main class="content">
    <section class="jumbotron">
  <div class="video">
    
    <div class="video-frame">
      <img src="/images/ocean/overlay-hero.png" alt="Decorative image frame">
    </div>
    
    <div class="video-media">
      <video playsinline="" autoplay="" loop="" muted="" data-autoplay="" poster="/images/ocean/ocean.png"
        x5-video-player-type="h5">
        <source src="/images/ocean/ocean.mp4" type="video/mp4">
        <source src="/images/ocean/ocean.ogv" type="video/ogg">
        <source src="/images/ocean/ocean.webm" type="video/webm">
        <p>Your user agent does not support the HTML5 Video element.</p>
      </video>
      <div class="video-overlay"></div>
    </div>
    <div class="video-inner text-center text-white">
      <h1><a href="/">个人博客</a></h1>
      <p>博客</p>
      <div><img src="/images/hexo-inverted.svg" class="brand" alt="个人博客"></div>
    </div>
    <div class="video-learn-more">
      <a class="anchor" href="#landingpage"><i class="fe fe-mouse"></i></a>
    </div>
  </div>
</section>
<div id="landingpage">
  <section class="outer">
  <article class="articles">
    
    <h1 class="page-type-title"></h1>
    
    
    <article id="post-flask-Python-编写的轻量级-Web-应用框架" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2018/11/19/flask-Python-%E7%BC%96%E5%86%99%E7%9A%84%E8%BD%BB%E9%87%8F%E7%BA%A7-Web-%E5%BA%94%E7%94%A8%E6%A1%86%E6%9E%B6/">flask-python 编写的轻量级 Web 应用框架</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2018/11/19/flask-Python-%E7%BC%96%E5%86%99%E7%9A%84%E8%BD%BB%E9%87%8F%E7%BA%A7-Web-%E5%BA%94%E7%94%A8%E6%A1%86%E6%9E%B6/" class="article-date">
  <time datetime="2018-11-19T01:36:00.000Z" itemprop="datePublished">2018-11-19</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <h1 id="flask-demo"><a href="#flask-demo" class="headerlink" title="flask-demo"></a>flask-demo</h1><p>flask: Python 编写的轻量级 Web 应用框架</p>
<h2 id="1-flask环境准备"><a href="#1-flask环境准备" class="headerlink" title="1.flask环境准备"></a>1.flask环境准备</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim requirements.txt</span><br><span class="line">flask</span><br><span class="line">flask_sqlalchemy</span><br><span class="line">mysqlclient</span><br><span class="line">redis</span><br><span class="line"></span><br><span class="line">安装pip install -r requirements.txt</span><br></pre></td></tr></table></figure>

<p>flask学习文档参考:<a target="_blank" rel="noopener" href="http://docs.jinkan.org/docs/flask/">http://docs.jinkan.org/docs/flask/</a></p>
<h2 id="2-flask第一行代码"><a href="#2-flask第一行代码" class="headerlink" title="2.flask第一行代码"></a>2.flask第一行代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1.初始化：所有的Flask都必须创建程序实例</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">第二部分，路由和视图函数：</span></span><br><span class="line"><span class="string">    客户端发送url给web服务器，web服务器将url转发给flask程序实例，程序实例</span></span><br><span class="line"><span class="string">    需要知道对于每一个url请求启动那一部分代码，所以保存了一个url和python函数的映射关系。</span></span><br><span class="line"><span class="string">    处理url和函数之间关系的程序，称为路由</span></span><br><span class="line"><span class="string">    在flask中，定义路由最简便的方式，是使用程序实例的app.route装饰器，把装饰的函数注册为路由</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/hello&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">第三部分：程序实例用run方法启动flask集成的开发web服务器</span></span><br><span class="line"><span class="string">    __name__ == &#x27;__main__&#x27;是python常用的方法，表示只有直接启动本脚本时候，才用app.run方法</span></span><br><span class="line"><span class="string">    服务器启动后，会启动轮询，等待并处理请求。轮询会一直请求，直到程序停止。</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, debug=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">flask接收web请求的执行流程</span></span><br><span class="line"><span class="string">    1.浏览器将请求给web服务器，web服务器将请求给app ,</span></span><br><span class="line"><span class="string">    2.app收到请求，通过路由找到对应的视图函数，然后将请求处理，得到一个响应response</span></span><br><span class="line"><span class="string">    3.然后app将响应返回给web服务器，</span></span><br><span class="line"><span class="string">    4.web服务器返回给浏览器，</span></span><br><span class="line"><span class="string">    5.浏览器展示给用户观看，流程完毕。</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>



<h2 id="3-结构分层模板"><a href="#3-结构分层模板" class="headerlink" title="3.结构分层模板"></a>3.结构分层模板</h2><h2 id="4-DEBUG调试"><a href="#4-DEBUG调试" class="headerlink" title="4.DEBUG调试"></a>4.DEBUG调试</h2><p>Pycharm断点调试</p>
<h2 id="5-flask连接数据库"><a href="#5-flask连接数据库" class="headerlink" title="5.flask连接数据库"></a>5.flask连接数据库</h2><p>官方文档参考:<a target="_blank" rel="noopener" href="http://www.pythondoc.com/flask-sqlalchemy/quickstart.html">http://www.pythondoc.com/flask-sqlalchemy/quickstart.html</a></p>
<h3 id="5-1-数据库连接配置"><a href="#5-1-数据库连接配置" class="headerlink" title="5.1.数据库连接配置"></a>5.1.数据库连接配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SQLALCHEMY_DATABASE_URI = &quot;mysql://root:123456@127.0.0.1/demo_test&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置每次请求结束后会自动提交数据库的改动</span></span><br><span class="line">SQLALCHEMY_TRACK_MODIFICATIONS = True</span><br><span class="line">SQLALCHEMY_COMMIT_ON_TEARDOWN = True</span><br></pre></td></tr></table></figure>



<h3 id="5-2-根据数据库逆向生成model"><a href="#5-2-根据数据库逆向生成model" class="headerlink" title="5.2.根据数据库逆向生成model"></a>5.2.根据数据库逆向生成model</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">将数据库中的所有表放在同一个实体中</span><br><span class="line">flask-sqlacodegen &#x27;mysql://root:123456@127.0.0.1/demo_test&#x27;  --outfile &quot;model/demo_test.py&quot;  --flask</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">将每一个表单独放在同一个实体中</span><br><span class="line">flask-sqlacodegen &#x27;mysql://root:123456@127.0.0.1/demo_test&#x27; --tables employees --outfile &quot;common/models/employees.py&quot;  --flask</span><br></pre></td></tr></table></figure>

<h2 id="6-GET-POST请求"><a href="#6-GET-POST请求" class="headerlink" title="6.GET/POST请求"></a>6.GET/POST请求</h2><h3 id="6-1-get请求查询数据库返回json格式"><a href="#6-1-get请求查询数据库返回json格式" class="headerlink" title="6.1.get请求查询数据库返回json格式"></a>6.1.get请求查询数据库返回json格式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/get/employee/&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_employee</span>():</span></span><br><span class="line">    employee_id = request.args.get(<span class="string">&quot;employeeId&quot;</span>)</span><br><span class="line">    logging.debug(<span class="string">&quot;employee_id = &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(employee_id))</span><br><span class="line">    <span class="keyword">if</span> employee_id.strip() ==<span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    result = Employee.query.<span class="built_in">filter</span>(Employee.<span class="built_in">id</span> == employee_id).<span class="built_in">all</span>()</span><br><span class="line">    <span class="keyword">for</span> employee <span class="keyword">in</span> result:</span><br><span class="line">        data = &#123;<span class="string">&quot;id&quot;</span>: employee.<span class="built_in">id</span>, <span class="string">&quot;lastname&quot;</span>: employee.lastname, <span class="string">&quot;email&quot;</span>: employee.email,</span><br><span class="line">                <span class="string">&quot;salary&quot;</span>: employee.salary, <span class="string">&quot;dept&quot;</span>: employee.dept&#125;</span><br><span class="line">        response = make_response(json.dumps(data, cls=DecimalEncoder, ensure_ascii=<span class="literal">False</span>))</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<h3 id="6-2-post请求查询数据库返回json格式"><a href="#6-2-post请求查询数据库返回json格式" class="headerlink" title="6.2.post请求查询数据库返回json格式"></a>6.2.post请求查询数据库返回json格式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/post/employee/&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post_employee</span>():</span></span><br><span class="line">    employee_id = request.form.get(<span class="string">&quot;employeeId&quot;</span>)</span><br><span class="line">    logging.debug(<span class="string">&quot;employee_id = &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(employee_id))</span><br><span class="line">    <span class="keyword">if</span> employee_id.strip() ==<span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    result = Employee.query.<span class="built_in">filter</span>(Employee.<span class="built_in">id</span> == employee_id).<span class="built_in">all</span>()</span><br><span class="line">    <span class="keyword">for</span> employee <span class="keyword">in</span> result:</span><br><span class="line">        data = &#123;<span class="string">&quot;id&quot;</span>: employee.<span class="built_in">id</span>, <span class="string">&quot;lastname&quot;</span>: employee.lastname, <span class="string">&quot;email&quot;</span>: employee.email,</span><br><span class="line">                <span class="string">&quot;salary&quot;</span>: employee.salary, <span class="string">&quot;dept&quot;</span>: employee.dept&#125;</span><br><span class="line">        response = make_response(json.dumps(data, cls=DecimalEncoder, ensure_ascii=<span class="literal">False</span>))</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>



<h2 id="7-读写redis"><a href="#7-读写redis" class="headerlink" title="7.读写redis"></a>7.读写redis</h2><h3 id="7-1-读写redis代码实现"><a href="#7-1-读写redis代码实现" class="headerlink" title="7.1.读写redis代码实现"></a>7.1.读写redis代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="comment">#  @staticmethod, 表示静态方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Redis</span>:</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">connect</span>(<span class="params">host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">6379</span>, db=<span class="number">0</span></span>):</span></span><br><span class="line">        r = redis.StrictRedis(host, port, db)</span><br><span class="line">        <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将内存数据二进制通过序列号转为文本流，再存入redis</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_data</span>(<span class="params">r, key, data, ex=<span class="literal">None</span></span>):</span></span><br><span class="line">        r.<span class="built_in">set</span>(pickle.dumps(key), pickle.dumps(data), ex)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将文本流从redis中读取并反序列化，返回</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_data</span>(<span class="params">r, key</span>):</span></span><br><span class="line">        data = r.get(pickle.dumps(key))</span><br><span class="line">        <span class="keyword">if</span> data <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> pickle.loads(data)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="8-日志配置"><a href="#8-日志配置" class="headerlink" title="8.日志配置"></a>8.日志配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot;</span><br><span class="line">     # 日志格式</span><br><span class="line">     [时间戳] \t [线程名] \t [日志级别] \t msg</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">import logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(level=logging.DEBUG,# 控制台打印的日志级别</span><br><span class="line">                    filename=&#x27;D:/003code/flask-demo/logs/log_new.log&#x27;,  # 将日志写入log_new.log文件中</span><br><span class="line">                    filemode=&#x27;a&#x27;, # 模式，有w和a，w就是写模式，每次都会重新写日志，覆盖之前的日志</span><br><span class="line">                    # a是追加模式，默认如果不写的话，就是追加模式</span><br><span class="line">                    format=</span><br><span class="line">                    &#x27;[%(asctime)s]    [%(threadName)s]    [%(levelname)s]   %(message)s&#x27;, datefmt=&#x27;%Y-%m-%d %H:%M:%S&#x27;</span><br><span class="line">                    )</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>配置完成后,需要将配置引入manager</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> config.log_conf</span><br></pre></td></tr></table></figure>



<h2 id="9-单元测试"><a href="#9-单元测试" class="headerlink" title="9.单元测试"></a>9.单元测试</h2><p>Python Flask，单元测试案例，unittest<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/houyanhua1/article/details/85689951">https://blog.csdn.net/houyanhua1/article/details/85689951</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/feilzhang/article/details/81041819">https://blog.csdn.net/feilzhang/article/details/81041819</a></p>
<ul>
<li>单元测试代码</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> manager <span class="keyword">import</span> app</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestHello</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 测试代码执行之前调用 (方法名固定)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.app = app</span><br><span class="line">        app.config[<span class="string">&#x27;TESTING&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">        self.client = self.app.test_client()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_hello</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 请求接口</span></span><br><span class="line">        response = self.client.get(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">        json_data = response.data</span><br><span class="line">        <span class="comment"># 按照json解析</span></span><br><span class="line">        json_dict = json.loads(json_data)</span><br><span class="line">        code = json_dict.get(<span class="string">&quot;code&quot;</span>)</span><br><span class="line">        <span class="comment"># 使用断言进行验证(判断字符串是否含有code)</span></span><br><span class="line">        self.assertIn(<span class="string">&quot;code&quot;</span>, json_dict)</span><br><span class="line">        <span class="comment"># 使用断言判断code是否为200</span></span><br><span class="line">        self.assertEqual(code, <span class="string">&quot;200&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestGetEmployee</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 测试代码执行之前调用 (方法名固定)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 配置数据库</span></span><br><span class="line">        app.config[<span class="string">&#x27;TESTING&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">        app.config[<span class="string">&#x27;SQLALCHEMY_DATABASE_URI&#x27;</span>] = <span class="string">&#x27;mysql://root:123456@127.0.0.1/demo_test&#x27;</span></span><br><span class="line">        app.config[<span class="string">&quot;SQLALCHEMY_TRACK_MODIFICATIONS&quot;</span>] = <span class="literal">True</span></span><br><span class="line">        app.config[<span class="string">&quot;SQLALCHEMY_COMMIT_ON_TEARDOWN&quot;</span>] = <span class="literal">True</span></span><br><span class="line">        self.app = app</span><br><span class="line">        self.client = self.app.test_client()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_post_employee</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 请求接口</span></span><br><span class="line">        response = self.client.post(<span class="string">&#x27;/post/employee/&#x27;</span>, data=&#123;<span class="string">&quot;employeeId&quot;</span>: <span class="number">2</span>&#125;)</span><br><span class="line">        json_data = response.data</span><br><span class="line">        <span class="comment"># 按照json解析</span></span><br><span class="line">        json_dict = json.loads(json_data)</span><br><span class="line">        <span class="comment"># 使用断言进行验证(判断字符串是否含有lastname)</span></span><br><span class="line">        self.assertIn(<span class="string">&quot;lastname&quot;</span>, json_dict)</span><br><span class="line">        <span class="comment"># 使用断言判断lastname是否为李四</span></span><br><span class="line">        last_name = json_dict.get(<span class="string">&quot;lastname&quot;</span>)</span><br><span class="line">        self.assertEqual(last_name, <span class="string">&quot;李四&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_get_employee</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 请求接口</span></span><br><span class="line">        response = self.client.get(<span class="string">&#x27;/get/employee/?employeeId=2&#x27;</span>)</span><br><span class="line">        json_data = response.data</span><br><span class="line">        <span class="comment"># 按照json解析</span></span><br><span class="line">        json_dict = json.loads(json_data)</span><br><span class="line">        <span class="comment"># 使用断言进行验证(判断字符串是否含有lastname)</span></span><br><span class="line">        self.assertIn(<span class="string">&quot;lastname&quot;</span>, json_dict)</span><br><span class="line">        <span class="comment"># 使用断言判断lastname是否为李四</span></span><br><span class="line">        last_name = json_dict.get(<span class="string">&quot;lastname&quot;</span>)</span><br><span class="line">        self.assertEqual(last_name, <span class="string">&quot;李四&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    unittest.main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="10-蓝图"><a href="#10-蓝图" class="headerlink" title="10 蓝图"></a>10 蓝图</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">注册路由 - 蓝图</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">待整理.....</span><br><span class="line"></span><br></pre></td></tr></table></figure>





      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/11/19/flask-Python-%E7%BC%96%E5%86%99%E7%9A%84%E8%BD%BB%E9%87%8F%E7%BA%A7-Web-%E5%BA%94%E7%94%A8%E6%A1%86%E6%9E%B6/" data-id="ckw60kwli0006dughaf6y2zyz" class="article-share-link">
        分享
      </a>
      
    </footer>

  </div>

  

  

</article>
    
    <article id="post-数据库服务器环境配置-ubuntu" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2018/11/01/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-ubuntu/">数据库服务器环境配置-ubuntu</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2018/11/01/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-ubuntu/" class="article-date">
  <time datetime="2018-11-01T02:41:00.000Z" itemprop="datePublished">2018-11-01</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <h3 id="1-ubuntu配置yum源"><a href="#1-ubuntu配置yum源" class="headerlink" title="1.ubuntu配置yum源"></a>1.ubuntu配置yum源</h3><h4 id="1-1-安装yum"><a href="#1-1-安装yum" class="headerlink" title="1.1. 安装yum"></a>1.1. <strong>安装yum</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install yum</span><br></pre></td></tr></table></figure>

<h4 id="1-2-配置yum源"><a href="#1-2-配置yum源" class="headerlink" title="1.2. 配置yum源"></a>1.2. <strong>配置yum源</strong></h4><p>在/etc/yum/repos.d/目录下创建两个文件，fedora-163.repo和fedora-updates-163.repo</p>
<p> 推荐使用vim编辑器。在终端使用： </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">vim fedora-163.repo</span><br><span class="line"></span><br><span class="line">内容如下:</span><br><span class="line"></span><br><span class="line">[fedora]</span><br><span class="line">name=Fedora 17 - $basearch - 163.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.163.com/fedora/releases/17/Everything/$basearch/os/</span><br><span class="line">mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=fedora-17&amp;arch=$basearch</span><br><span class="line">enabled=1</span><br><span class="line">metadata_expire=7d</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$basearch</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[fedora-debuginfo]</span><br><span class="line">name=Fedora 17 - $basearch - Debug - 163.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.163.com/fedora/releases/17/Everything/$basearch/debug/</span><br><span class="line">mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=fedora-debug-17&amp;arch=$basearch</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=7d</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$basearch</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[fedora-source]</span><br><span class="line">name=Fedora 17 - Source - 163.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.163.com/fedora/releases/17/Everything/source/SRPMS/</span><br><span class="line">mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=fedora-source-17&amp;arch=$basearch</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=7d</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$basearch</span><br></pre></td></tr></table></figure>

<p>vim  fedora-updates-163.repo </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[updates]</span><br><span class="line">name=Fedora 17 - $basearch - Updates - 163.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.163.com/fedora/updates/17/$basearch/</span><br><span class="line">mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=updates-released-f17&amp;arch=$basearch</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$basearch</span><br><span class="line"> </span><br><span class="line">[updates-debuginfo]</span><br><span class="line">name=Fedora 17 - $basearch - Updates - Debug - 163.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.163.com/fedora/updates/17/$basearch/debug/</span><br><span class="line">mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=updates-released-debug-f17&amp;arch=$basearch</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$basearch</span><br><span class="line"> </span><br><span class="line">[updates-source]</span><br><span class="line">name=Fedora 17 - Updates Source - 163.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.163.com/fedora/updates/17/SRPMS/</span><br><span class="line">mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=updates-released-source-f17&amp;arch=$basearch</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$basearch</span><br></pre></td></tr></table></figure>



<h4 id="1-3-执行配置"><a href="#1-3-执行配置" class="headerlink" title="1.3. 执行配置"></a>1.3. <strong>执行配置</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache</span><br></pre></td></tr></table></figure>



<p>如果行 yum makecache ,不成功先执行下列命令升级依赖</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>

<p>参考:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_42712552&#x2F;article&#x2F;details&#x2F;88363272</span><br></pre></td></tr></table></figure>



<h3 id="2-ubuntu16-0-4安装jdk"><a href="#2-ubuntu16-0-4安装jdk" class="headerlink" title="2.ubuntu16.0.4安装jdk"></a>2.ubuntu16.0.4安装jdk</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">加压缩安装包后,配置环境变量</span><br><span class="line"></span><br><span class="line">vim &#x2F;etc&#x2F;profile</span><br><span class="line"></span><br><span class="line">#JAVA_HOME</span><br><span class="line">export JAVA_HOME&#x3D;&#x2F;opt&#x2F;module&#x2F;1.8.0_181</span><br><span class="line">export PATH&#x3D;$PATH:$JAVA_HOME&#x2F;bin</span><br><span class="line"></span><br><span class="line">让修改后的文件生效</span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br><span class="line"></span><br><span class="line">测试JDK是否安装成功</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>

<h3 id="3-ubuntu16-0-4安装redis"><a href="#3-ubuntu16-0-4安装redis" class="headerlink" title="3.ubuntu16.0.4安装redis"></a>3.ubuntu16.0.4安装redis</h3><h4 id="3-1-安装redis环境依赖"><a href="#3-1-安装redis环境依赖" class="headerlink" title="3.1.安装redis环境依赖"></a>3.1.安装redis环境依赖</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#安装C程序运行环境</span><br><span class="line">yum -y install gcc-c++</span><br><span class="line"></span><br><span class="line"># 安装tcl</span><br><span class="line"></span><br><span class="line">wget http:&#x2F;&#x2F;downloads.sourceforge.net&#x2F;tcl&#x2F;tcl8.6.1-src.tar.gz  </span><br><span class="line">sudo tar xzvf tcl8.6.1-src.tar.gz  -C &#x2F;usr&#x2F;local&#x2F;  </span><br><span class="line">cd  &#x2F;usr&#x2F;local&#x2F;tcl8.6.1&#x2F;unix&#x2F;  </span><br><span class="line">sudo .&#x2F;configure  </span><br><span class="line">sudo make  </span><br><span class="line">sudo make install   </span><br><span class="line">————————————————</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="3-2-下载-编译和安装redis"><a href="#3-2-下载-编译和安装redis" class="headerlink" title="3.2.下载/编译和安装redis"></a>3.2.下载/编译和安装redis</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#下载redis</span><br><span class="line">wget http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-3.0.5.tar.gz</span><br><span class="line"></span><br><span class="line">#解压</span><br><span class="line"></span><br><span class="line">#进入到redis安装目录</span><br><span class="line">make MALLOC&#x3D;libc</span><br><span class="line">make</span><br><span class="line">make test &amp;&amp; make install</span><br></pre></td></tr></table></figure>



<h4 id="3-3-配置redis-conf"><a href="#3-3-配置redis-conf" class="headerlink" title="3.3.配置redis.conf"></a>3.3.配置redis.conf</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#在redis安装目录</span><br><span class="line">mkdir logs</span><br><span class="line">mkdir redisdata</span><br><span class="line"></span><br><span class="line">vim redis.conf</span><br><span class="line"></span><br><span class="line">#配置后台启动</span><br><span class="line">daemonize yes</span><br><span class="line">pidfile &#x2F;var&#x2F;run&#x2F;redis_6379.pid</span><br><span class="line">logfile &quot;&#x2F;opt&#x2F;module&#x2F;redis-3.0.5&#x2F;logs&#x2F;redis.log&quot;</span><br><span class="line">dir &#x2F;opt&#x2F;module&#x2F;redis-3.0.5&#x2F;redisdata</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">更改redis密码:</span><br><span class="line">config set requirepass Ikingtec909</span><br><span class="line">刷新验证密码</span><br><span class="line">auth Ikingtec909</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-4-启动与连接redis"><a href="#3-4-启动与连接redis" class="headerlink" title="3.4.启动与连接redis"></a>3.4.启动与连接redis</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#启动redis,进入到redis的src下</span><br><span class="line">.&#x2F;redis-server  ..&#x2F;redis.conf</span><br><span class="line"></span><br><span class="line">#连接redis,进入到redis的src下</span><br><span class="line">.&#x2F;redis-cli</span><br><span class="line"></span><br><span class="line">.&#x2F;redis-cli -p 6379 -a Ikingtec909</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-5-配置主从架构"><a href="#3-5-配置主从架构" class="headerlink" title="3.5.配置主从架构"></a>3.5.配置主从架构</h4><p>从服务器redis安装和上面相同</p>
<p>在redis.conf,多添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slaveof 主服务器ip 6379</span><br><span class="line">masterauth  Ikingtec909(密码)</span><br></pre></td></tr></table></figure>



<h3 id="4-ubuntu16-0-4安装mysql"><a href="#4-ubuntu16-0-4安装mysql" class="headerlink" title="4.ubuntu16.0.4安装mysql"></a>4.ubuntu16.0.4安装mysql</h3><h4 id="4-1-安装包下载地址"><a href="#4-1-安装包下载地址" class="headerlink" title="4.1.安装包下载地址"></a>4.1.安装包下载地址</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">下载(安装包)</span><br><span class="line"></span><br><span class="line">wget  https:&#x2F;&#x2F;cdn.mysql.com&#x2F;&#x2F;Downloads&#x2F;MySQL-5.7&#x2F;mysql-server_5.7.27-1ubuntu16.04_amd64.deb-bundle.tar</span><br></pre></td></tr></table></figure>

<h4 id="4-2-安装"><a href="#4-2-安装" class="headerlink" title="4.2.安装"></a>4.2.安装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">解压</span><br><span class="line">tar -xvf mysql-server_5.7.27-1ubuntu16.04_amd64.deb-bundle.tar</span><br><span class="line"></span><br><span class="line">安装</span><br><span class="line">sudo dpkg -i *.deb</span><br><span class="line">sudo apt-get -f install</span><br></pre></td></tr></table></figure>

<h4 id="4-3-登录"><a href="#4-3-登录" class="headerlink" title="4.3.登录"></a>4.3.登录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql  -u  用户名 –p</span><br></pre></td></tr></table></figure>

<h4 id="4-4-修改一些配置-参考"><a href="#4-4-修改一些配置-参考" class="headerlink" title="4.4.修改一些配置(参考)"></a>4.4.修改一些配置(参考)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">#启动</span><br><span class="line">service mysql start</span><br><span class="line"></span><br><span class="line">#停止</span><br><span class="line">service mysql stop</span><br><span class="line"></span><br><span class="line">#重启</span><br><span class="line">service mysql restart</span><br><span class="line"></span><br><span class="line"># 授权给特定host及用户</span><br><span class="line">登录到mysql</span><br><span class="line">use mysql;</span><br><span class="line">select host,user from user;</span><br><span class="line">update user set host &#x3D; &#39;%&#39; where user &#x3D;&#39;root&#39;;</span><br><span class="line">select host,user from user;</span><br><span class="line"></span><br><span class="line">#更改用户名和密码</span><br><span class="line"></span><br><span class="line">(适用于管理员或者有全局权限的用户重设其它用户的密码)</span><br><span class="line"></span><br><span class="line">进入命令行模式</span><br><span class="line"></span><br><span class="line">mysql -u root -p</span><br><span class="line"></span><br><span class="line">mysql&gt;use mysql;</span><br><span class="line"></span><br><span class="line">mysql&gt; UPDATE user SET password&#x3D;PASSWORD(&quot;new password&quot;) WHERE user&#x3D;&#39;username&#39;;</span><br><span class="line"></span><br><span class="line">示例5.7之后的版本:</span><br><span class="line">UPDATE user SET password&#x3D;PASSWORD(&quot;Ikingtec909&quot;) WHERE user&#x3D;&#39;root&#39;;</span><br><span class="line"></span><br><span class="line">5.7之前的版本:</span><br><span class="line">update mysql.user set authentication_string&#x3D;password(&#39;Ikingtec909&#39;) where user&#x3D;&#39;root&#39;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line">mysql&gt; quit;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#刷新权限</span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line">#修改配置文件设置数据写入格式utf-8</span><br><span class="line">vim &#x2F;etc&#x2F;mysql&#x2F;my.cnf</span><br><span class="line"></span><br><span class="line">加入下列配置</span><br><span class="line">[client]</span><br><span class="line">default_character_set&#x3D;utf8</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">default_character_set&#x3D;utf8</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">character_set_server&#x3D;utf8</span><br><span class="line"></span><br><span class="line">#修改配置文件远程访问</span><br><span class="line"></span><br><span class="line">vim &#x2F;etc&#x2F;mysql&#x2F;mysql.conf.d&#x2F;mysqld.cnf</span><br><span class="line"></span><br><span class="line">bind-address&#x3D; 0.0.0.0</span><br></pre></td></tr></table></figure>

<h4 id="4-5-重启mysql-确保防火墙允许-3306-端口开启"><a href="#4-5-重启mysql-确保防火墙允许-3306-端口开启" class="headerlink" title="4.5.重启mysql,  确保防火墙允许 3306 端口开启"></a>4.5.重启mysql,  <strong>确保防火墙允许 3306 端口开启</strong></h4><h4 id="4-6-mysq主从架构"><a href="#4-6-mysq主从架构" class="headerlink" title="4.6.mysq主从架构"></a>4.6.mysq主从架构</h4><h5 id="4-6-1-mysql主服务器配置"><a href="#4-6-1-mysql主服务器配置" class="headerlink" title="4.6.1.mysql主服务器配置"></a>4.6.1.mysql主服务器配置</h5><p>增加下列配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">#这是数据库ID,此ID是唯一的，主库默认为1，其他从库以此ID进行递增，ID值不能重复，否则会同步出错；</span><br><span class="line">server-id &#x3D; 1</span><br><span class="line">#默认 binlog日志存放路径，mysql-bin 日志名称</span><br><span class="line">#二进制日志文件，开启binlog,此项为必填项，否则不能同步数据；</span><br><span class="line">log-bin&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql-bin</span><br><span class="line">#日志中会记录成每一行数据被修改的形式</span><br><span class="line">#binlog日志格式</span><br><span class="line">binlog-format&#x3D;ROW</span><br><span class="line">#需要同步的数据库，如果需要同步多个数据库；则继续添加此项</span><br><span class="line">binlog-do-db &#x3D; ik_test_DB</span><br><span class="line"># binlog-do-db &#x3D; slaveDB1</span><br><span class="line"># binlog-do-db &#x3D; slaveDB2</span><br><span class="line">#不需要同步的数据库</span><br><span class="line">binlog-ignore-db &#x3D; mysql</span><br></pre></td></tr></table></figure>

<p>配置完成后数据库需要重启,然后查看binlog日志是否开启</p>
<p> show variables like ‘log_bin’; </p>
<h5 id="4-6-2-mysql从服务器配置"><a href="#4-6-2-mysql从服务器配置" class="headerlink" title="4.6.2.mysql从服务器配置"></a>4.6.2.mysql从服务器配置</h5><p>增加下列配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line">#从数据库配置</span><br><span class="line">server-id&#x3D;2</span><br><span class="line">relay-log&#x3D;mysql-relay</span><br><span class="line">#开启binlog,此项为必填项，否则不能同步数据；</span><br><span class="line">log-bin&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql-bin</span><br><span class="line">#binlog格式</span><br><span class="line">binlog-format&#x3D;ROW</span><br><span class="line">#此参数的含义是：slave数据库将二进制日志写入自己的binlog中</span><br><span class="line">log_slave_updates&#x3D;1</span><br><span class="line"></span><br><span class="line">#监控的数据库</span><br><span class="line">binlog-do-db&#x3D;ik_test_DB</span><br></pre></td></tr></table></figure>

<p>数据库重启:</p>
<p>service mysql restart</p>
<h5 id="4-6-3-在主服务器建立账户-并授权从服务器"><a href="#4-6-3-在主服务器建立账户-并授权从服务器" class="headerlink" title="4.6.3.在主服务器建立账户,并授权从服务器"></a>4.6.3.在主服务器建立账户,并授权从服务器</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT REPLICATION SLAVE ON *.* TO &#39;slave&#39;@&#39;从机器数据库IP&#39; IDENTIFIED BY &#39;123456&#39;</span><br></pre></td></tr></table></figure>

<h5 id="4-6-4-主服务器执行执行show-master-status"><a href="#4-6-4-主服务器执行执行show-master-status" class="headerlink" title="4.6.4.主服务器执行执行show master status"></a>4.6.4.主服务器执行执行show master status</h5><p>show master status</p>
<p>1.记录下File和Position的值</p>
<p>2.执行完此步骤后不要再操作主服务器MYSQL，防止主服务器状态值变化</p>
<h5 id="4-6-5-从服务器复制主服务器数据"><a href="#4-6-5-从服务器复制主服务器数据" class="headerlink" title="4.6.5.从服务器复制主服务器数据"></a>4.6.5.从服务器复制主服务器数据</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER TO MASTER_HOST&#x3D;&#39;主机IP&#39;,MASTER_USER&#x3D;&#39;用户名&#39;,MASTER_PASSWORD&#x3D;&#39;密码&#39;,MASTER_LOG_FILE&#x3D;&#39;File名字&#39;,MASTER_LOG_POS&#x3D;Position数字</span><br><span class="line"></span><br><span class="line">CHANGE MASTER TO MASTER_HOST&#x3D;&#39;172.26.69.85&#39;,MASTER_USER&#x3D;&#39;slave&#39;,MASTER_PASSWORD&#x3D;&#39;slave123&#39;,MASTER_LOG_FILE&#x3D;&#39;mysql-bin.000001&#39;,MASTER_LOG_POS&#x3D;441;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CHANGE MASTER TO MASTER_HOST&#x3D;&#39;172.26.69.85&#39;,MASTER_USER&#x3D;&#39;slave&#39;,MASTER_PASSWORD&#x3D;&#39;Ikingtec909&#39;,MASTER_LOG_FILE&#x3D;&#39;mysql-bin.000005&#39;,MASTER_LOG_POS&#x3D;2232;</span><br></pre></td></tr></table></figure>

<h5 id="4-6-6-从服务器启动slave"><a href="#4-6-6-从服务器启动slave" class="headerlink" title="4.6.6.从服务器启动slave"></a>4.6.6.从服务器启动slave</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start slave</span><br></pre></td></tr></table></figure>

<h5 id="4-6-7-查看slave状态"><a href="#4-6-7-查看slave状态" class="headerlink" title="4.6.7.查看slave状态"></a>4.6.7.查看slave状态</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show slave status\G;</span><br><span class="line">下面两个参数都是Yes，则说明主从配置成功！</span><br><span class="line">Slave_IO_Running: Yes</span><br><span class="line">Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure>

<h5 id="4-6-8-主机新建库、新建表、insert记录，从机复制"><a href="#4-6-8-主机新建库、新建表、insert记录，从机复制" class="headerlink" title="4.6.8.主机新建库、新建表、insert记录，从机复制"></a>4.6.8.主机新建库、新建表、insert记录，从机复制</h5><h5 id="4-6-9-停止从机复制功能"><a href="#4-6-9-停止从机复制功能" class="headerlink" title="4.6.9.停止从机复制功能"></a>4.6.9.停止从机复制功能</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stop slave</span><br></pre></td></tr></table></figure>

<h4 id="4-7-在从服务器加canal"><a href="#4-7-在从服务器加canal" class="headerlink" title="4.7.在从服务器加canal"></a>4.7.在从服务器加canal</h4><h5 id="4-7-1-新增一个用户权限"><a href="#4-7-1-新增一个用户权限" class="headerlink" title="4.7.1.新增一个用户权限"></a>4.7.1.新增一个用户权限</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &#39;canal&#39;@&#39;%&#39; IDENTIFIED </span><br><span class="line">BY &#39;canal&#39; ;</span><br></pre></td></tr></table></figure>



<h5 id="4-7-2-增加配置-这些配置在上述操作中已经添加"><a href="#4-7-2-增加配置-这些配置在上述操作中已经添加" class="headerlink" title="4.7.2.增加配置(这些配置在上述操作中已经添加)"></a>4.7.2.增加配置(这些配置在上述操作中已经添加)</h5><p>增加下列配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#binlog格式</span><br><span class="line">binlog-format&#x3D;ROW</span><br><span class="line">#此参数的含义是：slave数据库将二进制日志写入自己的binlog中</span><br><span class="line">log_slave_updates&#x3D;1</span><br><span class="line"></span><br><span class="line">#监控的数据库</span><br><span class="line">binlog-do-db&#x3D;ik_test_DB</span><br></pre></td></tr></table></figure>

<h5 id="4-7-3-重启mysql"><a href="#4-7-3-重启mysql" class="headerlink" title="4.7.3.重启mysql"></a>4.7.3.重启mysql</h5><p>service mysql restart</p>
<h5 id="4-7-4-安装canal"><a href="#4-7-4-安装canal" class="headerlink" title="4.7.4.安装canal"></a>4.7.4.安装canal</h5><p><a target="_blank" rel="noopener" href="https://github.com/alibaba/canal/releases">https://github.com/alibaba/canal/releases</a></p>
<h5 id="4-7-5-修改canal配置"><a href="#4-7-5-修改canal配置" class="headerlink" title="4.7.5.修改canal配置"></a>4.7.5.修改canal配置</h5><p>vim conf/canal.properties</p>
<p>这个文件是canal的基本通用配置，主要关心一下端口号，不改的话默认就是11111</p>
<p> vim conf/example/instance.properties</p>
<p>instance.properties是针对要追踪的mysql的实例配置</p>
<p>修改下列配置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#不能与mysql的server-id重复</span><br><span class="line">canal.instance.mysql.slaveId&#x3D;20</span><br><span class="line"></span><br><span class="line"># position info,配置mysqlip和端口号</span><br><span class="line">canal.instance.master.address&#x3D;172.26.69.84:3306</span><br><span class="line"></span><br><span class="line"># username&#x2F;password</span><br><span class="line">canal.instance.dbUsername&#x3D;canal</span><br><span class="line">canal.instance.dbPassword&#x3D;canal</span><br><span class="line">canal.instance.connectionCharset &#x3D; UTF-8</span><br><span class="line"></span><br><span class="line">#设置监听的库</span><br><span class="line">canal.instance.defaultDatabaseName &#x3D;ik_test_DB</span><br></pre></td></tr></table></figure>



<h5 id="4-7-6-启动canal"><a href="#4-7-6-启动canal" class="headerlink" title="4.7.6.启动canal"></a>4.7.6.启动canal</h5><p>/bin/startup.sh</p>
<p>jps   =&gt; CanalLauncher进程</p>
<p>如果起动不成功,排查问题参考</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.需要修改canal.properties配置，但是官网没有讲解。（大概率）进入canal解压文件 ，编辑conf&#x2F;canal.properties文件</span><br><span class="line">vim conf&#x2F;canal.properties</span><br><span class="line">有这么一行</span><br><span class="line">canal.instance.parser.parallelThreadSize &#x3D; 16</span><br><span class="line">默认是被注释掉的，需要打开注释,然后重启canal</span><br><span class="line">cd bin</span><br><span class="line">.&#x2F;restart.sh</span><br><span class="line">这种是第一次配置时，大概率碰到的情况。</span><br></pre></td></tr></table></figure>

<h5 id="4-7-6-测试"><a href="#4-7-6-测试" class="headerlink" title="4.7.6.测试"></a>4.7.6.测试</h5><p>参考地址:</p>
<p><a target="_blank" rel="noopener" href="https://github.com/alibaba/canal/wiki/QuickStart">https://github.com/alibaba/canal/wiki/QuickStart</a></p>
<p> <a target="_blank" rel="noopener" href="https://github.com/alibaba/canal/wiki/ClientExample">https://github.com/alibaba/canal/wiki/ClientExample</a> </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/11/01/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-ubuntu/" data-id="ckw60kwlk000cdugh8qhr166g" class="article-share-link">
        分享
      </a>
      
    </footer>

  </div>

  

  

</article>
    
    <article id="post-数据中台建设" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2018/05/20/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0%E5%BB%BA%E8%AE%BE/">数据中台建设</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2018/05/20/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0%E5%BB%BA%E8%AE%BE/" class="article-date">
  <time datetime="2018-05-20T06:28:00.000Z" itemprop="datePublished">2018-05-20</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <p><img src="/img/image-20210713183612991.png" alt="image-20210713183612991"></p>
<p><img src="/img/image-20210724121303860.png" alt="image-20210724121303860"></p>
<p><img src="/img/image-20210724121521554.png" alt="image-20210724121521554"></p>
<p>1.数据仓库:在企业管理和决策中面向主题的、集成的、与时间相关的，不可修改的数据集合</p>
<p>2.数据湖(Data Lake):一个以原始格式存储数据的存储库或系统</p>
<p>3.数据中台:避免数据的重复计算,通过数据服务化,提高数据的共享能力,赋能数据应用</p>
<p><img src="/img/image-20210724122127504.png" alt="image-20210724122127504"></p>
<p>数据平台建设前的五大问题:</p>
<p>1.指标口径不一致</p>
<p>2.数据重复建设</p>
<p>3.取数效率低</p>
<p>4.数据质量差</p>
<p>5.数据成本线上增长</p>
<p><img src="/img/image-20210724122911209.png" alt="image-20210724122911209"></p>
<p>数据中台建设三板斧</p>
<p>方法论 组织 技术</p>
<p><img src="/img/image-20210724173412012.png" alt="image-20210724173412012"></p>
<p><img src="/img/image-20210724173436864.png" alt="image-20210724173436864"></p>
<p>元数据中心的关键目标和技术实现方案</p>
<p><img src="/img/image-20210728170137924.png" alt="image-20210728170137924"></p>
<p>统一管理纷繁杂乱的数据指标</p>
<p><img src="/img/image-20210728170326445.png" alt="image-20210728170326445"></p>
<p><img src="/img/image-20210728170523964.png" alt="image-20210728170523964"></p>
<p><img src="/img/image-20210728170700373.png" alt="image-20210728170700373"></p>
<p>数据模型设计</p>
<p>表命名规范</p>
<p><img src="/img/image-20210728171940899.png" alt="image-20210728171940899"></p>
<p><img src="/img/image-20210728172225553.png" alt="image-20210728172225553"></p>
<p>数据有问题,如何提高数据质量</p>
<p><img src="/img/image-20210728172315078.png" alt="image-20210728172315078"></p>
<p>稽查校验任务</p>
<p><img src="/img/image-20210728172841216.png" alt="image-20210728172841216"></p>
<p><img src="/img/image-20210728173507306.png" alt="image-20210728173507306"></p>
<p>成本优化方案</p>
<p><img src="/img/image-20210728173746843.png" alt="image-20210728173746843"></p>
<p>OneData:数据发现、指标管理、模型设计、数据质量、成本优化</p>
<p>数据服务到底解决了什么问题</p>
<p><img src="/img/image-20210728175450772.png" alt="image-20210728175450772"></p>
<p><img src="/img/image-20210728183746600.png" alt="image-20210728183746600"></p>
<p>数据安全</p>
<p><img src="/img/image-20210728183937262.png" alt="image-20210728183937262"></p>
<p><img src="/img/image-20210728184150118.png" alt="image-20210728184150118"></p>
<p>数据中台的作用</p>
<p><img src="/img/image-20210728184525314.png" alt="image-20210728184525314"></p>
<p><img src="/img/image-20210728185259916.png" alt="image-20210728185259916"></p>
<p>数据研发流程</p>
<p><img src="/img/image-20210728185500129.png" alt="image-20210728185500129"></p>
<p>数据中台项目流程协作</p>
<p><img src="/img/image-20210728185710369.png" alt="image-20210728185710369"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/05/20/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0%E5%BB%BA%E8%AE%BE/" data-id="ckw60kwlk000adughg6to95lf" class="article-share-link">
        分享
      </a>
      
    </footer>

  </div>

  

  

</article>
    
    <article id="post-离线数据仓库建设" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2018/05/12/%E7%A6%BB%E7%BA%BF%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E5%BB%BA%E8%AE%BE/">离线数据仓库建设</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2018/05/12/%E7%A6%BB%E7%BA%BF%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E5%BB%BA%E8%AE%BE/" class="article-date">
  <time datetime="2018-05-12T15:37:00.000Z" itemprop="datePublished">2018-05-12</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <h2 id="离线数仓项目搭建流程"><a href="#离线数仓项目搭建流程" class="headerlink" title="离线数仓项目搭建流程"></a>离线数仓项目搭建流程</h2><p>项目背景:电商<br>分享重点:<br>离线数仓演进过程当中遇到的问题&amp;解决方案/思路<br>数据库&amp;数据仓库 范式建模  维度建模<br>维度表设计<br>事实表设计<br>kylin<br>mysql  hive kylin 展示</p>
<h3 id="1-离线数仓演进过程"><a href="#1-离线数仓演进过程" class="headerlink" title="1.离线数仓演进过程"></a>1.离线数仓演进过程</h3><h4 id="1-1-第一阶段"><a href="#1-1-第一阶段" class="headerlink" title="1.1.第一阶段"></a>1.1.第一阶段</h4><p>统计需求  mysql<br>业务系统：CRM系统、ERP系统、交易系统、商品系统、供应商系统….<br>随着发展 数据去决策<br>交易系统  order库<br>商品系统  item库<br>mysql  –&gt; hive –&gt; excel给到业务方<br>问题：1.烟囱式开发/重复开发 取数<br>延伸需求：建立数仓  –&gt; 数仓架构设计/表名规范/分层的设计 搭建各个主题域的中间层</p>
<h4 id="1-2-第二阶段"><a href="#1-2-第二阶段" class="headerlink" title="1.2.第二阶段"></a>1.2.第二阶段</h4><p>问题:<br>1.数据量上来之后 数据抽取的操作十分耗费时间 ===&gt; 如何去选择最优的一个数据抽取/存储策略</p>
<p>2.ETL任务 脚本跑在服务器上面</p>
<p>每天凌晨 定时在服务器 pull   push</p>
<p>如果修改代码  忘记提交了  ==&gt; 凌晨任务跑不来</p>
<p>解决方式:<strong>平台化 ETL开发平台  发布ETL任务</strong></p>
<p>3.调度问题 crontab 遇到上下游任务有依赖 a任务依赖b b任务依赖c<br>            c  1<br>            b  2 ==》 4<br>            a  3</p>
<p><strong>依赖调度 azkaban airflow DolphinScheduler</strong></p>
<h4 id="1-3-第三阶段"><a href="#1-3-第三阶段" class="headerlink" title="1.3.第三阶段"></a>1.3.第三阶段</h4><p>问题:<br>1.随着业务发展  业务系统需要进行一定程度的改造<br>            父子订单  购物车  a b c三个商品==&gt;order_id   子订单<br>                      购物车  trade_id  父订单<br>                      退款只是支持到trade维度<br>            数仓当中有一张order表 下游<br>            批次 有批次  一品多商<br>                 无批次  一品一商<br>            数据血缘</p>
<p>2.业务方质疑你的数据不准<br>可能原因:数据口径不统一  我真的取错数据了(sql写错了)<br>            gmv 下单金额+优惠券金额<br>                 下单金额</p>
<p>解决方案:<strong>指标中心</strong></p>
<p>数据抽取挂了 分表64张  60张 ==&gt; </p>
<p>解决方案:<strong>数据质量中心(DQC) 监控每天数据条数变化  对应指标</strong></p>
<p>3.任务跑的慢 sql写的不规范</p>
<p>hive分区表<br>a 365分区<br>b 365分区</p>
<p>需求：多维分析  ==&gt; kylin+BI系统<br>     数据血缘 + 指标中心 + 数仓表(数据字典) ==&gt; 元数据中心<br>     BI多了起来 取数 desc xx hue</p>
<h4 id="1-4-第四阶段"><a href="#1-4-第四阶段" class="headerlink" title="1.4.第四阶段"></a>1.4.第四阶段</h4><p>问题：集群稳定性 cdh</p>
<p>采集各个系统(数据团队)的关键数据 ==&gt; 图表 离线任务运行时长</p>
<pre><code> 枚举 trade_type 10 11 12...
      0:xxx  1:yyy 2:zzz ....
      case when
      枚举中心  预警、界面 k-v ==&gt; 码表
</code></pre>
<h3 id="2-如何去做数仓架构设计"><a href="#2-如何去做数仓架构设计" class="headerlink" title="2.如何去做数仓架构设计"></a>2.如何去做数仓架构设计</h3><pre><code>数据抽取 sqoop/datax
 数仓分层
     ODS operational data store
         最接近数据源当中的一层 尽量保持和源端的数据格式一样
     DW
         DWD  该层保持和ODS层一样的数据粒度  数据清洗(过滤、日期格式转换 时间戳--&gt;yyyy-MM-dd等)的操作
         DWM  数据中间层 提升数仓公共指标的复用性 减少重复加工
              交易域 商品域 CRM域 门店域 流量域...
              下单商品  下单金额 下单时间  支付状态 ...
         DWS  生成字段比较多的宽表 提供给后续的业务查询
              select xxx from tbl where dayid=&#39;xxx&#39; group by xx
     APP 数据应用层
            report(报表)  严禁读取ods dwd层 中间层建设不完善
         kylin数据
         数据加工st_xxx
     DIM维表
         数仓通用的维表  时间/地区/类目/商品....
 数据回流  sync_xxxx脚本 mysql提供给业务系统

 数仓表名、字段名 命名规范
     数仓里的表在天上飞
     数仓表名和ETL任务名 保持一致 hive -v -e &quot;insert xxxx select xxxx&quot;
     ods_t_item_d  ods_t_item_d.sh
     st_itm_gmv_d  st_itm_gmv_d.sh
     sync_st_itm_gmv_d.sh select xxx   sqoop命令
 
     _d天更新
     _m月更新
     _h按小时更新
 
     _i增量表 数据是增量
     _s拉链表
     ODS层    层级_业务库_mysql表名_d
              ods_trade_pay_xxx_d/i
     中间层   层级_主题域_业务过程_[/d/h/m...]
              dws层 _1d 统计日当天的汇总数据
                    _nd 统计近n天的汇总数据
                    _mtd 统计当月累计到统计日的汇总数据
                    _td  统计的就是历史全量数据
                    _dth
     维表     dim_维度名称_d 每日全量表
              dim_维度名称   全量表
              dim_维度名称_ds 拉链表 极限存储表
 
 技术选型
     数据抽取  sqoop/datax
     数仓      Hive    impala Greenplum
     传统数仓  oracle
     数据回流  sqoop/datax
</code></pre>
<p> 数据平台架构图(离线)</p>
<p><img src="/img/hdkaslgfi6d.png" alt="upload successful"></p>
<h3 id="3-数据库-amp-数据仓库"><a href="#3-数据库-amp-数据仓库" class="headerlink" title="3.数据库&amp;数据仓库"></a>3.数据库&amp;数据仓库</h3><pre><code>范式
第零范式  无重复数据
第一范式  满足属性不可分
第二范式  在第一范式的基础上更进一步，确保数据库的表当中每一个字段都只和主键相关
第三范式  确保数据表中的每一列数据都和主键直接相关，而不能间接相关
          在第二范式的基础上 属性只直接依赖主键

数据仓库和范式之间存在着一种什么样的关系
维度建模中的星型模型  在范式理论上是符合第二范式
            雪花模型  星型模型和雪花模型最大区别在于  维度表是否和事实表直接相连

有冗余的事实表
    将一些维度信息，比如说用户信息、商品信息 冗余到订单事实表中
    在范式理论上是符合第一范式

数据库和数据仓库各自的侧重点
    对于绝大多数的数据仓库设计来说，一般情况下都不会去考虑是否满足第几范式
    数据库 设计 联机事务处理  OLTP(on-line transaction processing) 各种的增删改查操作
    数据仓库    联机分析处理  OLAP  面向日常数据分析  数据插入和查询，基本上不会去涉及数据的删除和修改操作

数据库面向事务的设计  数仓面向主题的设计
业务系统              分系系统
order_id              历史数据
尽量避免冗余          刻意的去引入冗余操作
</code></pre>
<p> 第一范式<br><img src="/img/diyiimage.png" alt="upload successful"></p>
<p>第二范式<br><img src="/img/diewreree.png" alt="upload successful"></p>
<p>第三范式<br><img src="/img/disainaaaaade.png" alt="upload successful"></p>
<h3 id="4-维度表"><a href="#4-维度表" class="headerlink" title="4.维度表"></a>4.维度表</h3><h4 id="4-1维度的基本概念"><a href="#4-1维度的基本概念" class="headerlink" title="4.1维度的基本概念"></a>4.1维度的基本概念</h4><pre><code>度量 指标  称为 事实
对于一些环境的描述 称为 维度
select
  item,      --&gt; 维度
  sum(gmv)   --&gt; 聚合指标 
from tbl
group by item
分析交易过程  商品、时间、买家(客户 消费者)、卖家(供应商)  ==&gt; 用于分析指标所需要的一个多样的环境

维度获取方式
    1.业务定义的  
    2.数据中去获取
</code></pre>
<h3 id="4-2-如何去设计一张维度表"><a href="#4-2-如何去设计一张维度表" class="headerlink" title="4.2.如何去设计一张维度表"></a>4.2.如何去设计一张维度表</h3><pre><code>1.选择维度  商品 时间 地区...
2. select
    xxx
   from
   (
         select xx
   ) as t1
   left join
   ...
   确定一张主维表  t_item
3.确定相关/需要关联的维表
  spu  店铺  商家  类目
  sku
4.确定维度属性
  1.尽可能的丰富  下游在使用我们的维度表更方便 统计分析类的操作
    ID Name
  2.字段 作为维度 具体的事实
    通常情况下用于查询的约束条件(where) 或者  用于分组统计(group by)
    通常参与实际的度量计算  事实
</code></pre>
<p>维度的层次结构<br>    上卷  下钻</p>
<p>类目、地区、品牌是否应该全部存在于一张商品维表当中？<br>规范化<br>    对于大多数的OLTP系统来说，底层的数据模型设计时 通常会采用规范化的方式<br>    将一些维度属性 移到 他们自身所属的表当中，删除冗余数据</p>
<pre><code>类目 商品 ==&gt; 1:n
</code></pre>
<p>反规范化<br>    退化维度  冗余一部分数据  一张平表  打平<br>    易用性比较高  存储成本升高了</p>
<p>规范化&amp;反规范化.png<br><img src="/img/gjdsjka34f.png" alt="upload successful"></p>
<p>一致性维度<br>    流量   item pv uv<br>    交易   item gmv<br>    数据探查(交叉探查):将不同业务域(数据域)的商品维度的数据给结合到一块进行展示<br>    item pv uv gmv</p>
<pre><code>商品维度 流量  a b c
         交易  b c d e f g
时间维度 timestamp
         yyyy-MM-dd

针对这类问题 如何去保证维度的一致性
    共享维度表
</code></pre>
<p>维度整合&amp;拆分<br>    数据仓库的定义：面向主题的、集成的数据集合<br>    表现形式&amp;注意点：<br>        表名、字段名 的 命名规范的统一<br>                        字段类型的统一<br>        业务含义相同的表进行统一，高内聚、低耦合的设计理念<br>            源端 数据形式 差异较小的表进行整合<br>            源端 数据形式 差异很大的表进行拆分</p>
<pre><code>        主从表设计
        直接合并 a b 2个bu
            1 2 3 类目
                  a
                  b

            a类目 b类目
        不合并
    直接合并
        垂直整合  类目   bu字段
                  a
                  b
                  c
                  ..
        水平整合  打平
</code></pre>
<p>维度拆分<br>    水平拆分</p>
<pre><code>维度设计过程当中，可能会遇到的问题：
    1.某些维表属性的来源表 产出数据的时间比较早  4   a
      某些维表属性的来源表 产出数据的时间比较晚  12  b
                                                     c
    2.某些维表的属性/字段  热度比较高  使用比较频繁
      某些维表的属性/字段  热度比较低  使用比较少
    3.某些维表的属性/字段  经常会变化/不怎么变(稳定)
主从表 主表 重要的维度属性

设计原则
    扩展性  粒度不一样  高内聚 低耦合
    易用性
    效率
</code></pre>
<p>历史数据的归档<br>    归档到oss去<br>    归档策略1：前台商品展示的策略：商品状态 商品是否被删除 更新策略<br>               ==&gt; 对应的下单信息就不会有这批商品<br>               前台商品的归档策略<br>               问题：实现后 维护成本很高<br>    归档策略2：binlog<br>    ===&gt; 了解一下<br>    京东 sku 1.5T  250亿  15亿</p>
<pre><code>归档策略3：自定义  通过设置数仓表的生命周期
           ods 3    6.7==》6 5 4
                      8==》7 6 5
           dwd 93
           dw  93
           ...
           report 历史全部保留
           增量表 历史全部保留
</code></pre>
<p>缓慢变化维<br>    数仓的重要特点 就是 反应了数据的历史变化<br>    如何去处理维度的变化是整个维度设计过程中的最重要工作<br>    维度的变化实际上是不怎么频繁的<br>    第一种处理方式：重写维度值<br>    第二种处理方式：新增维度行<br>    第三种处理方式：新增维度列<br>    实际生产使用 看场景</p>
<p>快照维表<br>    快照：某个时间点的状态<br>    快照的周期：多久去获取一次数据  天  h 1min<br>    问题：按天获取快照，如何获取？<br>    item  分区表，以天进行分区<br>    mysql<br>    0601   item1   item<br>    0602   item2   item<br>    …    …     …<br>    0607   item7   item<br>    item表每天都在insert 和 update  拓展：delete?  如果删除的话 是物理删除还是逻辑删除?  is_deleted<br>    ==》<br>    按天进行数据抽取的操作 T+1 数据是延迟1天<br>    0602的凌晨1点  去抽取  mysql端截止到0601 24:00  create_time  update_time(edit_time) dt=20200601<br>    0603<br>    0604<br>    …<br>    0607<br>    …<br>    抽取是全量抽取</p>
<pre><code>这样的构建方式是否会有问题？
    第一个性能问题：存储
    1张表 365个分区
    n张表 n*365
    (1+2+3+4+5+6+7+...+365) * 3 or 2  hdfs是3副本(2副本)

    第二个性能问题：抽取性能  业务库的压力
    sqoop抽取 抽取慢 -m往上加  一定程度上去加快整体的抽取速率
    凌晨 对多个实例 进行抽取
           1个实例  会有多个mysql库
           1个库    会有多张mysql表
           DBA团队
</code></pre>
<p>增量抽取&amp;merge<br>极限存储(拉链表)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/05/12/%E7%A6%BB%E7%BA%BF%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E5%BB%BA%E8%AE%BE/" data-id="ckw60kwll000edugh5bmj6kh4" class="article-share-link">
        分享
      </a>
      
    </footer>

  </div>

  

  

</article>
    
    <article id="post-离线数仓建设2" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2018/05/12/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93%E5%BB%BA%E8%AE%BE2/">离线数仓建设2</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2018/05/12/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93%E5%BB%BA%E8%AE%BE2/" class="article-date">
  <time datetime="2018-05-12T06:45:00.000Z" itemprop="datePublished">2018-05-12</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <h2 id="1-增量数据同步"><a href="#1-增量数据同步" class="headerlink" title="1.增量数据同步"></a>1.增量数据同步</h2><h3 id="1-1-增量抽取-merge到全量的过程"><a href="#1-1-增量抽取-merge到全量的过程" class="headerlink" title="1.1.增量抽取+merge到全量的过程"></a>1.1.增量抽取+merge到全量的过程</h3><p>ods:增量（每个时间分区）</p>
<p>dwd:全量（每个时间分区）</p>
<p>增量数据抽取条件：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">where</span> (create_time <span class="operator">&gt;=</span> <span class="number">2017</span><span class="number">-06</span><span class="number">-01</span> <span class="keyword">or</span> update_time <span class="operator">&gt;=</span> <span class="number">2017</span><span class="number">-06</span><span class="number">-01</span>)</span><br></pre></td></tr></table></figure>
<p>ods层增量数据合并到dwd层全量数据</p>
<p>1.确定关联键唯一（一般用id）</p>
<p>2.</p>
<p>全量表</p>
<p>left join</p>
<p>增量表 on 全量表.id = 增量表.id</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span></span><br><span class="line"><span class="comment">--全量表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> dwd_order_d(</span><br><span class="line">pay_day string,</span><br><span class="line">trade_no string,</span><br><span class="line">phone string,</span><br><span class="line">pay_amount <span class="type">decimal</span>(<span class="number">18</span>,<span class="number">2</span>),</span><br><span class="line">pay_status <span class="type">int</span>,</span><br><span class="line">update_time string</span><br><span class="line">)</span><br><span class="line"><span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span></span><br><span class="line">stored <span class="keyword">as</span> textfile;</span><br><span class="line"></span><br><span class="line"><span class="comment">--增量表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> ods_order_di(</span><br><span class="line">pay_day string,</span><br><span class="line">trade_no string,</span><br><span class="line">phone string,</span><br><span class="line">pay_amount <span class="type">decimal</span>(<span class="number">18</span>,<span class="number">2</span>),</span><br><span class="line">pay_status <span class="type">int</span>,</span><br><span class="line">update_time string</span><br><span class="line">)</span><br><span class="line"><span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span></span><br><span class="line">stored <span class="keyword">as</span> textfile;</span><br><span class="line"><span class="number">2.</span>数据导入</span><br><span class="line">order_his.txt</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-01</span>,<span class="number">001</span>,<span class="number">111111</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">2017</span><span class="number">-06</span><span class="number">-01</span></span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-01</span>,<span class="number">002</span>,<span class="number">222222</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">2017</span><span class="number">-06</span><span class="number">-01</span></span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-01</span>,<span class="number">003</span>,<span class="number">333333</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">2017</span><span class="number">-06</span><span class="number">-01</span></span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-01</span>,<span class="number">004</span>,<span class="number">444444</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">2017</span><span class="number">-06</span><span class="number">-01</span></span><br><span class="line"></span><br><span class="line">order_increment.txt</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-01</span>,<span class="number">002</span>,<span class="number">222222</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2017</span><span class="number">-06</span><span class="number">-02</span></span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-01</span>,<span class="number">004</span>,<span class="number">444444</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">2017</span><span class="number">-06</span><span class="number">-02</span></span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-02</span>,<span class="number">005</span>,<span class="number">444444</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">2017</span><span class="number">-06</span><span class="number">-02</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/opt/data/order_his.txt&#x27;</span> overwrite <span class="keyword">into</span> <span class="keyword">table</span> dwd_order_d</span><br><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/opt/data/order_increment.txt&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> ods_order_di</span><br><span class="line"></span><br><span class="line">写<span class="keyword">sql</span>合并：</span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">table</span> dwd_order_d</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  a.pay_day,</span><br><span class="line">  a.trade_no,</span><br><span class="line">  a.phone,</span><br><span class="line">  a.pay_amount,</span><br><span class="line">  a.pay_status,</span><br><span class="line">  a.update_time</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">   <span class="keyword">select</span></span><br><span class="line">     pay_day,</span><br><span class="line">     trade_no,</span><br><span class="line">     phone,</span><br><span class="line">     pay_amount,</span><br><span class="line">     pay_status,</span><br><span class="line">     update_time</span><br><span class="line">   <span class="keyword">from</span> dwd_order_d</span><br><span class="line">) <span class="keyword">as</span> a</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span></span><br><span class="line">(</span><br><span class="line">   <span class="keyword">select</span></span><br><span class="line">     pay_day,</span><br><span class="line">     trade_no,</span><br><span class="line">     phone,</span><br><span class="line">     pay_amount,</span><br><span class="line">     pay_status,</span><br><span class="line">     update_time</span><br><span class="line">   <span class="keyword">from</span> ods_order_di</span><br><span class="line">) <span class="keyword">as</span> b</span><br><span class="line"><span class="keyword">on</span> a.trade_no <span class="operator">=</span> b.trade_no</span><br><span class="line"><span class="keyword">where</span> b.trade_no <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  pay_day,</span><br><span class="line"> trade_no,</span><br><span class="line"> phone,</span><br><span class="line"> pay_amount,</span><br><span class="line"> pay_status,</span><br><span class="line"> update_time</span><br><span class="line"><span class="keyword">from</span> ods_order_di</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>增量抽取+merge到全量的过程</p>
<p>1.抽取性能提升  业务库的压力减少了</p>
<p>2.数仓中的数据变化</p>
<p>dwd层 一直都是全量，是没减少的<br>ods层 是减少了  原先天天全量抽取  现在天天增量抽取  但是不明显<br>   因为ods层只保留3天的数据</p>
<h3 id="1-2-拉链表"><a href="#1-2-拉链表" class="headerlink" title="1.2.拉链表"></a>1.2.拉链表</h3><h4 id="1-2-1-拉链表介绍"><a href="#1-2-1-拉链表介绍" class="headerlink" title="1.2.1.拉链表介绍"></a>1.2.1.拉链表介绍</h4><p>1.多了start_date和end_date这2个字段  标识了所在记录的生命周期</p>
<p>拉链表的意义是什么</p>
<p>方式一：全量抽取   ods+dwd 按天分区 天天全量</p>
<p>dwd数据量(一年数据为例):    <strong>365*每天全量数据</strong></p>
<p>方式二：增量抽取 + merge到全量表    dwd层时 按天分区 天天全量</p>
<p>dwd数据量(一年数据为例):<strong>1<em>全量数据 + 364</em>每天全量的数据</strong></p>
<p>方式三：拉链表  最大的作用就是 降低了非常多的存储<br>dwd数据量(一年数据为例):<strong>初始化拉链表时的全量数据 + 天<em>更新的数据（1</em>全量数据 + 364*每天更新的数据）</strong></p>
<p>拉链表 能够兼顾一种场景 业务上要看历史上某个时刻的数据</p>
<h4 id="1-2-2-拉链表实现"><a href="#1-2-2-拉链表实现" class="headerlink" title="1.2.2.拉链表实现"></a>1.2.2.拉链表实现</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--ods层的初始化全量表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> ods_order_d(</span><br><span class="line">pay_day string,</span><br><span class="line">trade_no string,</span><br><span class="line">phone string,</span><br><span class="line">pay_amount <span class="type">decimal</span>(<span class="number">18</span>,<span class="number">2</span>),</span><br><span class="line">pay_status <span class="type">int</span>,</span><br><span class="line">update_time string</span><br><span class="line">)</span><br><span class="line"><span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span></span><br><span class="line">stored <span class="keyword">as</span> textfile;</span><br><span class="line">数据导入：</span><br><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/opt/data/order_his.txt&#x27;</span> overwrite <span class="keyword">into</span> <span class="keyword">table</span> ods_order_d</span><br><span class="line"></span><br><span class="line"><span class="comment">--ods层的订单更新表</span></span><br><span class="line">ods_order_di</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 拉链表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> dwd_order_ds(</span><br><span class="line">pay_day string,</span><br><span class="line">trade_no string,</span><br><span class="line">phone string,</span><br><span class="line">pay_amount <span class="type">decimal</span>(<span class="number">18</span>,<span class="number">2</span>),</span><br><span class="line">pay_status <span class="type">int</span>,</span><br><span class="line">start_date string,</span><br><span class="line">end_date string</span><br><span class="line">)</span><br><span class="line"><span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span></span><br><span class="line">stored <span class="keyword">as</span> textfile;</span><br><span class="line"></span><br><span class="line">第一步：初始化拉链表</span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">table</span> dwd_order_ds</span><br><span class="line">selectpay_day,trade_no,phone,pay_amount,pay_status,<span class="string">&#x27;2018-06-01&#x27;</span> <span class="keyword">as</span> start_date,<span class="string">&#x27;9999-12-31&#x27;</span> <span class="keyword">as</span> end_date <span class="keyword">from</span> ods_order_d;</span><br><span class="line"></span><br><span class="line">第二步：</span><br><span class="line">	<span class="number">1.</span>对于历史上已经被更新掉的数据  end_date 要从<span class="number">9999</span><span class="number">-12</span><span class="number">-31</span>改为失效的那一天日期</span><br><span class="line">	<span class="number">2.</span>要将新增的记录 <span class="keyword">or</span> 被更新的记录 给<span class="keyword">insert</span>进去  同时将对应的<span class="keyword">start</span> <span class="keyword">end</span>给赋值</span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">table</span> dwd_order_ds</span><br><span class="line"><span class="keyword">select</span> t.<span class="operator">*</span> <span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> a.pay_day,a.trade_no,a.phone,a.pay_amount,a.pay_status,a.start_date,<span class="keyword">case</span> <span class="keyword">when</span> a.end_date<span class="operator">=</span><span class="string">&#x27;9999-12-31&#x27;</span> <span class="keyword">and</span> b.trade_no <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">then</span> <span class="string">&#x27;2018-06-01&#x27;</span> <span class="keyword">else</span> a.end_date <span class="keyword">end</span> <span class="keyword">as</span> end_date <span class="keyword">from</span> dwd_order_ds <span class="keyword">as</span> a <span class="keyword">left</span> <span class="keyword">join</span> ods_order_di <span class="keyword">as</span> b <span class="keyword">on</span> a.trade_no <span class="operator">=</span> b.trade_no</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> c.pay_day,c.trade_no,c.phone,c.pay_amount,c.pay_status,</span><br><span class="line"><span class="string">&#x27;2018-06-02&#x27;</span> <span class="keyword">as</span> start_date,<span class="string">&#x27;9999-12-31&#x27;</span> <span class="keyword">as</span> end_date <span class="keyword">from</span> ods_order_di <span class="keyword">as</span> c) <span class="keyword">as</span> t</span><br></pre></td></tr></table></figure>

<h4 id="1-2-3-拉链表缺点"><a href="#1-2-3-拉链表缺点" class="headerlink" title="1.2.3.拉链表缺点"></a>1.2.3.拉链表缺点</h4><h5 id="1-上游数据加字段问题"><a href="#1-上游数据加字段问题" class="headerlink" title="1.上游数据加字段问题"></a>1.上游数据加字段问题</h5><p>mysql端:a字段在2018-06-01加上了 而且a字段很重要 业务统计要用的</p>
<p>hive端  a字段  2020-06-07才知道 </p>
<p>1-7号  关于a字段的状态 丢了？1个月后 业务统计又恰好需要历史状态</p>
<p>mysql业务库上,要加的这个字段a,对于历史数据来说他是有默认值的</p>
<p>hive端 对于拉链表来说  历史的数据也需要有默认值</p>
<p><strong>解决方式</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> overwrite xxx</span><br><span class="line"><span class="keyword">select</span> a,b,</span><br><span class="line">...</span><br><span class="line"><span class="number">0</span> <span class="keyword">as</span> new_column</span><br><span class="line"><span class="keyword">from</span> dwd_order_ds</span><br></pre></td></tr></table></figure>

<h5 id="2-上游数据出现脏数据"><a href="#2-上游数据出现脏数据" class="headerlink" title="2.上游数据出现脏数据"></a>2.上游数据出现脏数据</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">以订单数据为例  变化周期是固定   确定业务周期 这些数据过了这个周期是不会再变了</span><br><span class="line">  数据结转  dt(分区字段)  过期  历史  活跃</span><br><span class="line">  	过期   所有生命周期已经无效了的数据</span><br><span class="line">  	历史   不会再做任何变更的数据</span><br><span class="line">  	活跃   在固定业务周期内 还会做变化的数据</span><br></pre></td></tr></table></figure>
<h5 id="3-注意点"><a href="#3-注意点" class="headerlink" title="3.注意点"></a>3.注意点</h5><p>关联键 一定要和业务开发 确认好 是否能够确保关联的时候不会出问题  </p>
<h5 id="4-拉链表优化"><a href="#4-拉链表优化" class="headerlink" title="4.拉链表优化"></a>4.拉链表优化</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>存储格式  列式存储 orc</span><br><span class="line"><span class="number">2.</span>指定分区字段  查询能做分区裁剪</span><br><span class="line">		dt</span><br><span class="line">业务上的时间  pay_day,update_time</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/05/12/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93%E5%BB%BA%E8%AE%BE2/" data-id="ckw60kwll000ddughdc1w1cnz" class="article-share-link">
        分享
      </a>
      
    </footer>

  </div>

  

  

</article>
    
    <article id="post-Tensorflow" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2016/11/19/Tensorflow/">Tensorflow</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2016/11/19/Tensorflow/" class="article-date">
  <time datetime="2016-11-19T02:42:00.000Z" itemprop="datePublished">2016-11-19</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <h3 id="1-Tensorflow"><a href="#1-Tensorflow" class="headerlink" title="1.Tensorflow"></a>1.Tensorflow</h3><h4 id="1-1-Tensorflow安装"><a href="#1-1-Tensorflow安装" class="headerlink" title="1.1.Tensorflow安装"></a>1.1.Tensorflow安装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"># 安装</span><br><span class="line">pip install tensorflow</span><br><span class="line"></span><br><span class="line">问题1:</span><br><span class="line">Failed calling sys.__interactivehook__</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">File &quot;H:\anaconda3\lib\site.py&quot;, line 439, in register_readline</span><br><span class="line">readline.read_history_file(history)</span><br><span class="line">File &quot;H:\anaconda3\lib\site-packages\pyreadline\rlmain.py&quot;, line 165, in read_history_file</span><br><span class="line">self.mode._history.read_history_file(filename)</span><br><span class="line">File &quot;H:\anaconda3\lib\site-packages\pyreadline\lineeditor\history.py&quot;, line 82, in read_history_file</span><br><span class="line">for line in open(filename, &#39;r&#39;):</span><br><span class="line">UnicodeDecodeError: &#39;gbk&#39; codec can&#39;t decode byte 0x90 in position 683: illegal multibyte sequence</span><br><span class="line"></span><br><span class="line">解决</span><br><span class="line">可以 进入到该目录：Anaconda3\Lib\site-packages\pyreadline\lineeditor ，</span><br><span class="line">history.py文件的第82行，修改如下：</span><br><span class="line">for line in open(filename, &#39;r&#39;,encoding&#x3D;&#39;utf-8&#39;):</span><br><span class="line">在原有的open函数里 新增了一个参数选项encoding&#x3D;&#39;utf-8&#39;</span><br><span class="line">就可以解决了</span><br><span class="line"></span><br><span class="line">问题2:</span><br><span class="line">在cmd输入python出现“Warning:This Python interpreter is in a conda environment, but the environment has no</span><br><span class="line"></span><br><span class="line">1、出现这种错误是因为安装的是Anaconda中带的python版本，python处于conda环境中，使用python需要激活；</span><br><span class="line"></span><br><span class="line">2、可以在cmd中输入conda info --envs，查看Anaconda的位置，复制base后面的位置信息；</span><br><span class="line"></span><br><span class="line">3、输入conda activate C:\Users\Anaconda3，根据自己的位置修改C:\Users\Anaconda3为自己电脑上base后面的位置信，即可以激活python环境，就可以没有警告了</span><br><span class="line">————————————————</span><br><span class="line">在cmd输入python出现“Warning:This Python interpreter is in a conda environment, but the environment has no</span><br><span class="line"></span><br><span class="line">安装的是anaconda3，出现提示错误后，按照百度的办法，输入 conda acticate D:\Anaconda以启动python编译器，但又报错按照invocation，先输入 CALL conda.bat activate运行</span><br><span class="line"></span><br><span class="line">再输入python</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">问题3:</span><br><span class="line">AttributeError: module &#39;tensorflow&#39; has no attribute &#39;Session&#39;错误解决</span><br><span class="line"></span><br><span class="line">解决:</span><br><span class="line"></span><br><span class="line">Ubuntu刚安装好Tensorflow以后运行</span><br><span class="line">import tensorflow as tf</span><br><span class="line">tf.Session()</span><br><span class="line">报错AttributeError: module &#39;tensorflow&#39; has no attribute &#39;Session&#39;。这其实不是安装错误，是因为在新的Tensorflow 2.0版本中已经移除了Session这一模块，改换运行代码</span><br><span class="line"></span><br><span class="line">tf.compat.v1.Session()</span><br><span class="line">就可以获得与原先相同的输出信息。如果觉得不方便，也可以改换低版本的Tensorflow，直接用pip即可安装</span><br><span class="line"></span><br><span class="line"> pip install tensorflow&#x3D;&#x3D;1.14</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 查看版本</span><br><span class="line">python</span><br><span class="line"></span><br><span class="line">import tensorflow as tf</span><br><span class="line"></span><br><span class="line">tf.__version__</span><br><span class="line"></span><br><span class="line">查询tensorflow安装路径为:</span><br><span class="line"></span><br><span class="line">tf.__path__</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="jupyter"><a href="#jupyter" class="headerlink" title="jupyter"></a>jupyter</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pip install jupyter</span><br><span class="line"></span><br><span class="line">python -m ipykernel install --user --name=venv</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启用notebook</span></span><br><span class="line">jupyter notebook</span><br></pre></td></tr></table></figure>



<h3 id="2-人脸识别"><a href="#2-人脸识别" class="headerlink" title="2.人脸识别"></a>2.人脸识别</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 环境准备</span></span><br><span class="line"></span><br><span class="line">python3.7+dlib+face_recognition(亲测有效)</span><br><span class="line"></span><br><span class="line">1、pip install cmake</span><br><span class="line">2、boost的安装</span><br><span class="line">直接在cmd下</span><br><span class="line">pip install boost</span><br><span class="line">3、dlib的安装</span><br><span class="line">下面链接直接下载python3.7的dlib</span><br><span class="line">链接：https://pan.baidu.com/s/17lVu2egTUGOmJbH_YO6IdQ</span><br><span class="line">提取码：ur13</span><br><span class="line">下载成功后，cmd+.whl的文件路径+python -m pip install xx.whl+回车键。</span><br><span class="line">ok，成功。</span><br><span class="line">————————————————</span><br><span class="line">4、face_recognition的安装</span><br><span class="line">在cmd下直接</span><br><span class="line">pip install face_recognition</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="简单人脸识别代码实现（python）"><a href="#简单人脸识别代码实现（python）" class="headerlink" title="简单人脸识别代码实现（python）"></a>简单人脸识别代码实现（python）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检测人脸</span></span><br><span class="line"><span class="keyword">import</span> face_recognition</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取图片并识别人脸</span></span><br><span class="line">img = face_recognition.load_image_file(<span class="string">&quot;1.jpg&quot;</span>)</span><br><span class="line">face_locations = face_recognition.face_locations(img)</span><br><span class="line"><span class="built_in">print</span>(face_locations)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用opencv函数显示图片</span></span><br><span class="line">img = cv2.imread(<span class="string">&quot;1.jpg&quot;</span>)</span><br><span class="line">cv2.namedWindow(<span class="string">&quot;原图&quot;</span>)</span><br><span class="line">cv2.imshow(<span class="string">&quot;原图&quot;</span>, img)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历每个人脸，并标注</span></span><br><span class="line">faceNum = <span class="built_in">len</span>(face_locations)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, faceNum):</span><br><span class="line">    top = face_locations[i][<span class="number">0</span>]</span><br><span class="line">    right = face_locations[i][<span class="number">1</span>]</span><br><span class="line">    bottom = face_locations[i][<span class="number">2</span>]</span><br><span class="line">    left = face_locations[i][<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    start = (left, top)</span><br><span class="line">    end = (right, bottom)</span><br><span class="line"></span><br><span class="line">    color = (<span class="number">55</span>, <span class="number">255</span>, <span class="number">155</span>)</span><br><span class="line">    thickness = <span class="number">3</span></span><br><span class="line">    cv2.rectangle(img, start, end, color, thickness)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示识别结果</span></span><br><span class="line">cv2.namedWindow(<span class="string">&quot;识别&quot;</span>)</span><br><span class="line">cv2.imshow(<span class="string">&quot;识别&quot;</span>, img)</span><br><span class="line"></span><br><span class="line">cv2.waitKey(<span class="number">0</span>)</span><br><span class="line">cv2.destroyAllWindows()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2016/11/19/Tensorflow/" data-id="ckw60kwlh0003dughgu1nah7q" class="article-share-link">
        分享
      </a>
      
    </footer>

  </div>

  

  

</article>
    
  </article>
  

  
  <nav class="page-nav">
    <a class="extend prev" rel="prev" href="/">上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>
  
</section>
</div>
    <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
  <li><i class="fe fe-bar-chart"></i> <span id="busuanzi_value_site_pv"></span></li>
  
  <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>个人博客 &copy; 2021</li>
      
        <li>ZHWANGART</li>
      
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>theme  <a target="_blank" rel="noopener" href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
  </div>
</footer>
  </main>
  <aside class="sidebar">
    <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/hexo.svg" alt="个人博客"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">Home</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">Archives</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/gallery">Gallery</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">About</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="搜索">
        <i class="fe fe-search"></i>
        搜索
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="fe fe-feed"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
  </aside>
  
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/copybtn.js"></script>






<script src="/js/ocean.js"></script>

</body>

</html>