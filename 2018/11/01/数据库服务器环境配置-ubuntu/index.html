<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  <meta name="description" content="记录技术点滴">
  
  <title>
    数据库服务器环境配置-ubuntu |
    
    个人博客
  </title>
  
    <link rel="shortcut icon" href="/favicon.ico">
    
  
<link rel="stylesheet" href="/css/style.css">

  
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <main class="content">
    <section class="outer">
  <article id="post-数据库服务器环境配置-ubuntu" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h1 class="article-title" itemprop="name">
  数据库服务器环境配置-ubuntu
</h1>



    </header>
    

    
    <div class="article-meta">
      <a href="/2018/11/01/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-ubuntu/" class="article-date">
  <time datetime="2018-11-01T02:41:00.000Z" itemprop="datePublished">2018-11-01</time>
</a>
      
    </div>
    

    
    
<div class="tocbot"></div>

    

    <div class="article-entry" itemprop="articleBody">
      
      
      
      <h3 id="1-ubuntu配置yum源"><a href="#1-ubuntu配置yum源" class="headerlink" title="1.ubuntu配置yum源"></a>1.ubuntu配置yum源</h3><h4 id="1-1-安装yum"><a href="#1-1-安装yum" class="headerlink" title="1.1. 安装yum"></a>1.1. <strong>安装yum</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install yum</span><br></pre></td></tr></table></figure>

<h4 id="1-2-配置yum源"><a href="#1-2-配置yum源" class="headerlink" title="1.2. 配置yum源"></a>1.2. <strong>配置yum源</strong></h4><p>在/etc/yum/repos.d/目录下创建两个文件，fedora-163.repo和fedora-updates-163.repo</p>
<p> 推荐使用vim编辑器。在终端使用： </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">vim fedora-163.repo</span><br><span class="line"></span><br><span class="line">内容如下:</span><br><span class="line"></span><br><span class="line">[fedora]</span><br><span class="line">name=Fedora 17 - $basearch - 163.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.163.com/fedora/releases/17/Everything/$basearch/os/</span><br><span class="line">mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=fedora-17&amp;arch=$basearch</span><br><span class="line">enabled=1</span><br><span class="line">metadata_expire=7d</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$basearch</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[fedora-debuginfo]</span><br><span class="line">name=Fedora 17 - $basearch - Debug - 163.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.163.com/fedora/releases/17/Everything/$basearch/debug/</span><br><span class="line">mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=fedora-debug-17&amp;arch=$basearch</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=7d</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$basearch</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[fedora-source]</span><br><span class="line">name=Fedora 17 - Source - 163.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.163.com/fedora/releases/17/Everything/source/SRPMS/</span><br><span class="line">mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=fedora-source-17&amp;arch=$basearch</span><br><span class="line">enabled=0</span><br><span class="line">metadata_expire=7d</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$basearch</span><br></pre></td></tr></table></figure>

<p>vim  fedora-updates-163.repo </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[updates]</span><br><span class="line">name=Fedora 17 - $basearch - Updates - 163.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.163.com/fedora/updates/17/$basearch/</span><br><span class="line">mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=updates-released-f17&amp;arch=$basearch</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$basearch</span><br><span class="line"> </span><br><span class="line">[updates-debuginfo]</span><br><span class="line">name=Fedora 17 - $basearch - Updates - Debug - 163.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.163.com/fedora/updates/17/$basearch/debug/</span><br><span class="line">mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=updates-released-debug-f17&amp;arch=$basearch</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$basearch</span><br><span class="line"> </span><br><span class="line">[updates-source]</span><br><span class="line">name=Fedora 17 - Updates Source - 163.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.163.com/fedora/updates/17/SRPMS/</span><br><span class="line">mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=updates-released-source-f17&amp;arch=$basearch</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$basearch</span><br></pre></td></tr></table></figure>



<h4 id="1-3-执行配置"><a href="#1-3-执行配置" class="headerlink" title="1.3. 执行配置"></a>1.3. <strong>执行配置</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache</span><br></pre></td></tr></table></figure>



<p>如果行 yum makecache ,不成功先执行下列命令升级依赖</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>

<p>参考:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_42712552&#x2F;article&#x2F;details&#x2F;88363272</span><br></pre></td></tr></table></figure>



<h3 id="2-ubuntu16-0-4安装jdk"><a href="#2-ubuntu16-0-4安装jdk" class="headerlink" title="2.ubuntu16.0.4安装jdk"></a>2.ubuntu16.0.4安装jdk</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">加压缩安装包后,配置环境变量</span><br><span class="line"></span><br><span class="line">vim &#x2F;etc&#x2F;profile</span><br><span class="line"></span><br><span class="line">#JAVA_HOME</span><br><span class="line">export JAVA_HOME&#x3D;&#x2F;opt&#x2F;module&#x2F;1.8.0_181</span><br><span class="line">export PATH&#x3D;$PATH:$JAVA_HOME&#x2F;bin</span><br><span class="line"></span><br><span class="line">让修改后的文件生效</span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br><span class="line"></span><br><span class="line">测试JDK是否安装成功</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>

<h3 id="3-ubuntu16-0-4安装redis"><a href="#3-ubuntu16-0-4安装redis" class="headerlink" title="3.ubuntu16.0.4安装redis"></a>3.ubuntu16.0.4安装redis</h3><h4 id="3-1-安装redis环境依赖"><a href="#3-1-安装redis环境依赖" class="headerlink" title="3.1.安装redis环境依赖"></a>3.1.安装redis环境依赖</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#安装C程序运行环境</span><br><span class="line">yum -y install gcc-c++</span><br><span class="line"></span><br><span class="line"># 安装tcl</span><br><span class="line"></span><br><span class="line">wget http:&#x2F;&#x2F;downloads.sourceforge.net&#x2F;tcl&#x2F;tcl8.6.1-src.tar.gz  </span><br><span class="line">sudo tar xzvf tcl8.6.1-src.tar.gz  -C &#x2F;usr&#x2F;local&#x2F;  </span><br><span class="line">cd  &#x2F;usr&#x2F;local&#x2F;tcl8.6.1&#x2F;unix&#x2F;  </span><br><span class="line">sudo .&#x2F;configure  </span><br><span class="line">sudo make  </span><br><span class="line">sudo make install   </span><br><span class="line">————————————————</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="3-2-下载-编译和安装redis"><a href="#3-2-下载-编译和安装redis" class="headerlink" title="3.2.下载/编译和安装redis"></a>3.2.下载/编译和安装redis</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#下载redis</span><br><span class="line">wget http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-3.0.5.tar.gz</span><br><span class="line"></span><br><span class="line">#解压</span><br><span class="line"></span><br><span class="line">#进入到redis安装目录</span><br><span class="line">make MALLOC&#x3D;libc</span><br><span class="line">make</span><br><span class="line">make test &amp;&amp; make install</span><br></pre></td></tr></table></figure>



<h4 id="3-3-配置redis-conf"><a href="#3-3-配置redis-conf" class="headerlink" title="3.3.配置redis.conf"></a>3.3.配置redis.conf</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#在redis安装目录</span><br><span class="line">mkdir logs</span><br><span class="line">mkdir redisdata</span><br><span class="line"></span><br><span class="line">vim redis.conf</span><br><span class="line"></span><br><span class="line">#配置后台启动</span><br><span class="line">daemonize yes</span><br><span class="line">pidfile &#x2F;var&#x2F;run&#x2F;redis_6379.pid</span><br><span class="line">logfile &quot;&#x2F;opt&#x2F;module&#x2F;redis-3.0.5&#x2F;logs&#x2F;redis.log&quot;</span><br><span class="line">dir &#x2F;opt&#x2F;module&#x2F;redis-3.0.5&#x2F;redisdata</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">更改redis密码:</span><br><span class="line">config set requirepass Ikingtec909</span><br><span class="line">刷新验证密码</span><br><span class="line">auth Ikingtec909</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-4-启动与连接redis"><a href="#3-4-启动与连接redis" class="headerlink" title="3.4.启动与连接redis"></a>3.4.启动与连接redis</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#启动redis,进入到redis的src下</span><br><span class="line">.&#x2F;redis-server  ..&#x2F;redis.conf</span><br><span class="line"></span><br><span class="line">#连接redis,进入到redis的src下</span><br><span class="line">.&#x2F;redis-cli</span><br><span class="line"></span><br><span class="line">.&#x2F;redis-cli -p 6379 -a Ikingtec909</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-5-配置主从架构"><a href="#3-5-配置主从架构" class="headerlink" title="3.5.配置主从架构"></a>3.5.配置主从架构</h4><p>从服务器redis安装和上面相同</p>
<p>在redis.conf,多添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slaveof 主服务器ip 6379</span><br><span class="line">masterauth  Ikingtec909(密码)</span><br></pre></td></tr></table></figure>



<h3 id="4-ubuntu16-0-4安装mysql"><a href="#4-ubuntu16-0-4安装mysql" class="headerlink" title="4.ubuntu16.0.4安装mysql"></a>4.ubuntu16.0.4安装mysql</h3><h4 id="4-1-安装包下载地址"><a href="#4-1-安装包下载地址" class="headerlink" title="4.1.安装包下载地址"></a>4.1.安装包下载地址</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">下载(安装包)</span><br><span class="line"></span><br><span class="line">wget  https:&#x2F;&#x2F;cdn.mysql.com&#x2F;&#x2F;Downloads&#x2F;MySQL-5.7&#x2F;mysql-server_5.7.27-1ubuntu16.04_amd64.deb-bundle.tar</span><br></pre></td></tr></table></figure>

<h4 id="4-2-安装"><a href="#4-2-安装" class="headerlink" title="4.2.安装"></a>4.2.安装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">解压</span><br><span class="line">tar -xvf mysql-server_5.7.27-1ubuntu16.04_amd64.deb-bundle.tar</span><br><span class="line"></span><br><span class="line">安装</span><br><span class="line">sudo dpkg -i *.deb</span><br><span class="line">sudo apt-get -f install</span><br></pre></td></tr></table></figure>

<h4 id="4-3-登录"><a href="#4-3-登录" class="headerlink" title="4.3.登录"></a>4.3.登录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql  -u  用户名 –p</span><br></pre></td></tr></table></figure>

<h4 id="4-4-修改一些配置-参考"><a href="#4-4-修改一些配置-参考" class="headerlink" title="4.4.修改一些配置(参考)"></a>4.4.修改一些配置(参考)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">#启动</span><br><span class="line">service mysql start</span><br><span class="line"></span><br><span class="line">#停止</span><br><span class="line">service mysql stop</span><br><span class="line"></span><br><span class="line">#重启</span><br><span class="line">service mysql restart</span><br><span class="line"></span><br><span class="line"># 授权给特定host及用户</span><br><span class="line">登录到mysql</span><br><span class="line">use mysql;</span><br><span class="line">select host,user from user;</span><br><span class="line">update user set host &#x3D; &#39;%&#39; where user &#x3D;&#39;root&#39;;</span><br><span class="line">select host,user from user;</span><br><span class="line"></span><br><span class="line">#更改用户名和密码</span><br><span class="line"></span><br><span class="line">(适用于管理员或者有全局权限的用户重设其它用户的密码)</span><br><span class="line"></span><br><span class="line">进入命令行模式</span><br><span class="line"></span><br><span class="line">mysql -u root -p</span><br><span class="line"></span><br><span class="line">mysql&gt;use mysql;</span><br><span class="line"></span><br><span class="line">mysql&gt; UPDATE user SET password&#x3D;PASSWORD(&quot;new password&quot;) WHERE user&#x3D;&#39;username&#39;;</span><br><span class="line"></span><br><span class="line">示例5.7之后的版本:</span><br><span class="line">UPDATE user SET password&#x3D;PASSWORD(&quot;Ikingtec909&quot;) WHERE user&#x3D;&#39;root&#39;;</span><br><span class="line"></span><br><span class="line">5.7之前的版本:</span><br><span class="line">update mysql.user set authentication_string&#x3D;password(&#39;Ikingtec909&#39;) where user&#x3D;&#39;root&#39;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line">mysql&gt; quit;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#刷新权限</span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line">#修改配置文件设置数据写入格式utf-8</span><br><span class="line">vim &#x2F;etc&#x2F;mysql&#x2F;my.cnf</span><br><span class="line"></span><br><span class="line">加入下列配置</span><br><span class="line">[client]</span><br><span class="line">default_character_set&#x3D;utf8</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">default_character_set&#x3D;utf8</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">character_set_server&#x3D;utf8</span><br><span class="line"></span><br><span class="line">#修改配置文件远程访问</span><br><span class="line"></span><br><span class="line">vim &#x2F;etc&#x2F;mysql&#x2F;mysql.conf.d&#x2F;mysqld.cnf</span><br><span class="line"></span><br><span class="line">bind-address&#x3D; 0.0.0.0</span><br></pre></td></tr></table></figure>

<h4 id="4-5-重启mysql-确保防火墙允许-3306-端口开启"><a href="#4-5-重启mysql-确保防火墙允许-3306-端口开启" class="headerlink" title="4.5.重启mysql,  确保防火墙允许 3306 端口开启"></a>4.5.重启mysql,  <strong>确保防火墙允许 3306 端口开启</strong></h4><h4 id="4-6-mysq主从架构"><a href="#4-6-mysq主从架构" class="headerlink" title="4.6.mysq主从架构"></a>4.6.mysq主从架构</h4><h5 id="4-6-1-mysql主服务器配置"><a href="#4-6-1-mysql主服务器配置" class="headerlink" title="4.6.1.mysql主服务器配置"></a>4.6.1.mysql主服务器配置</h5><p>增加下列配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">#这是数据库ID,此ID是唯一的，主库默认为1，其他从库以此ID进行递增，ID值不能重复，否则会同步出错；</span><br><span class="line">server-id &#x3D; 1</span><br><span class="line">#默认 binlog日志存放路径，mysql-bin 日志名称</span><br><span class="line">#二进制日志文件，开启binlog,此项为必填项，否则不能同步数据；</span><br><span class="line">log-bin&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql-bin</span><br><span class="line">#日志中会记录成每一行数据被修改的形式</span><br><span class="line">#binlog日志格式</span><br><span class="line">binlog-format&#x3D;ROW</span><br><span class="line">#需要同步的数据库，如果需要同步多个数据库；则继续添加此项</span><br><span class="line">binlog-do-db &#x3D; ik_test_DB</span><br><span class="line"># binlog-do-db &#x3D; slaveDB1</span><br><span class="line"># binlog-do-db &#x3D; slaveDB2</span><br><span class="line">#不需要同步的数据库</span><br><span class="line">binlog-ignore-db &#x3D; mysql</span><br></pre></td></tr></table></figure>

<p>配置完成后数据库需要重启,然后查看binlog日志是否开启</p>
<p> show variables like ‘log_bin’; </p>
<h5 id="4-6-2-mysql从服务器配置"><a href="#4-6-2-mysql从服务器配置" class="headerlink" title="4.6.2.mysql从服务器配置"></a>4.6.2.mysql从服务器配置</h5><p>增加下列配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line">#从数据库配置</span><br><span class="line">server-id&#x3D;2</span><br><span class="line">relay-log&#x3D;mysql-relay</span><br><span class="line">#开启binlog,此项为必填项，否则不能同步数据；</span><br><span class="line">log-bin&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql-bin</span><br><span class="line">#binlog格式</span><br><span class="line">binlog-format&#x3D;ROW</span><br><span class="line">#此参数的含义是：slave数据库将二进制日志写入自己的binlog中</span><br><span class="line">log_slave_updates&#x3D;1</span><br><span class="line"></span><br><span class="line">#监控的数据库</span><br><span class="line">binlog-do-db&#x3D;ik_test_DB</span><br></pre></td></tr></table></figure>

<p>数据库重启:</p>
<p>service mysql restart</p>
<h5 id="4-6-3-在主服务器建立账户-并授权从服务器"><a href="#4-6-3-在主服务器建立账户-并授权从服务器" class="headerlink" title="4.6.3.在主服务器建立账户,并授权从服务器"></a>4.6.3.在主服务器建立账户,并授权从服务器</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT REPLICATION SLAVE ON *.* TO &#39;slave&#39;@&#39;从机器数据库IP&#39; IDENTIFIED BY &#39;123456&#39;</span><br></pre></td></tr></table></figure>

<h5 id="4-6-4-主服务器执行执行show-master-status"><a href="#4-6-4-主服务器执行执行show-master-status" class="headerlink" title="4.6.4.主服务器执行执行show master status"></a>4.6.4.主服务器执行执行show master status</h5><p>show master status</p>
<p>1.记录下File和Position的值</p>
<p>2.执行完此步骤后不要再操作主服务器MYSQL，防止主服务器状态值变化</p>
<h5 id="4-6-5-从服务器复制主服务器数据"><a href="#4-6-5-从服务器复制主服务器数据" class="headerlink" title="4.6.5.从服务器复制主服务器数据"></a>4.6.5.从服务器复制主服务器数据</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER TO MASTER_HOST&#x3D;&#39;主机IP&#39;,MASTER_USER&#x3D;&#39;用户名&#39;,MASTER_PASSWORD&#x3D;&#39;密码&#39;,MASTER_LOG_FILE&#x3D;&#39;File名字&#39;,MASTER_LOG_POS&#x3D;Position数字</span><br><span class="line"></span><br><span class="line">CHANGE MASTER TO MASTER_HOST&#x3D;&#39;172.26.69.85&#39;,MASTER_USER&#x3D;&#39;slave&#39;,MASTER_PASSWORD&#x3D;&#39;slave123&#39;,MASTER_LOG_FILE&#x3D;&#39;mysql-bin.000001&#39;,MASTER_LOG_POS&#x3D;441;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CHANGE MASTER TO MASTER_HOST&#x3D;&#39;172.26.69.85&#39;,MASTER_USER&#x3D;&#39;slave&#39;,MASTER_PASSWORD&#x3D;&#39;Ikingtec909&#39;,MASTER_LOG_FILE&#x3D;&#39;mysql-bin.000005&#39;,MASTER_LOG_POS&#x3D;2232;</span><br></pre></td></tr></table></figure>

<h5 id="4-6-6-从服务器启动slave"><a href="#4-6-6-从服务器启动slave" class="headerlink" title="4.6.6.从服务器启动slave"></a>4.6.6.从服务器启动slave</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start slave</span><br></pre></td></tr></table></figure>

<h5 id="4-6-7-查看slave状态"><a href="#4-6-7-查看slave状态" class="headerlink" title="4.6.7.查看slave状态"></a>4.6.7.查看slave状态</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show slave status\G;</span><br><span class="line">下面两个参数都是Yes，则说明主从配置成功！</span><br><span class="line">Slave_IO_Running: Yes</span><br><span class="line">Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure>

<h5 id="4-6-8-主机新建库、新建表、insert记录，从机复制"><a href="#4-6-8-主机新建库、新建表、insert记录，从机复制" class="headerlink" title="4.6.8.主机新建库、新建表、insert记录，从机复制"></a>4.6.8.主机新建库、新建表、insert记录，从机复制</h5><h5 id="4-6-9-停止从机复制功能"><a href="#4-6-9-停止从机复制功能" class="headerlink" title="4.6.9.停止从机复制功能"></a>4.6.9.停止从机复制功能</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stop slave</span><br></pre></td></tr></table></figure>

<h4 id="4-7-在从服务器加canal"><a href="#4-7-在从服务器加canal" class="headerlink" title="4.7.在从服务器加canal"></a>4.7.在从服务器加canal</h4><h5 id="4-7-1-新增一个用户权限"><a href="#4-7-1-新增一个用户权限" class="headerlink" title="4.7.1.新增一个用户权限"></a>4.7.1.新增一个用户权限</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &#39;canal&#39;@&#39;%&#39; IDENTIFIED </span><br><span class="line">BY &#39;canal&#39; ;</span><br></pre></td></tr></table></figure>



<h5 id="4-7-2-增加配置-这些配置在上述操作中已经添加"><a href="#4-7-2-增加配置-这些配置在上述操作中已经添加" class="headerlink" title="4.7.2.增加配置(这些配置在上述操作中已经添加)"></a>4.7.2.增加配置(这些配置在上述操作中已经添加)</h5><p>增加下列配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#binlog格式</span><br><span class="line">binlog-format&#x3D;ROW</span><br><span class="line">#此参数的含义是：slave数据库将二进制日志写入自己的binlog中</span><br><span class="line">log_slave_updates&#x3D;1</span><br><span class="line"></span><br><span class="line">#监控的数据库</span><br><span class="line">binlog-do-db&#x3D;ik_test_DB</span><br></pre></td></tr></table></figure>

<h5 id="4-7-3-重启mysql"><a href="#4-7-3-重启mysql" class="headerlink" title="4.7.3.重启mysql"></a>4.7.3.重启mysql</h5><p>service mysql restart</p>
<h5 id="4-7-4-安装canal"><a href="#4-7-4-安装canal" class="headerlink" title="4.7.4.安装canal"></a>4.7.4.安装canal</h5><p><a target="_blank" rel="noopener" href="https://github.com/alibaba/canal/releases">https://github.com/alibaba/canal/releases</a></p>
<h5 id="4-7-5-修改canal配置"><a href="#4-7-5-修改canal配置" class="headerlink" title="4.7.5.修改canal配置"></a>4.7.5.修改canal配置</h5><p>vim conf/canal.properties</p>
<p>这个文件是canal的基本通用配置，主要关心一下端口号，不改的话默认就是11111</p>
<p> vim conf/example/instance.properties</p>
<p>instance.properties是针对要追踪的mysql的实例配置</p>
<p>修改下列配置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#不能与mysql的server-id重复</span><br><span class="line">canal.instance.mysql.slaveId&#x3D;20</span><br><span class="line"></span><br><span class="line"># position info,配置mysqlip和端口号</span><br><span class="line">canal.instance.master.address&#x3D;172.26.69.84:3306</span><br><span class="line"></span><br><span class="line"># username&#x2F;password</span><br><span class="line">canal.instance.dbUsername&#x3D;canal</span><br><span class="line">canal.instance.dbPassword&#x3D;canal</span><br><span class="line">canal.instance.connectionCharset &#x3D; UTF-8</span><br><span class="line"></span><br><span class="line">#设置监听的库</span><br><span class="line">canal.instance.defaultDatabaseName &#x3D;ik_test_DB</span><br></pre></td></tr></table></figure>



<h5 id="4-7-6-启动canal"><a href="#4-7-6-启动canal" class="headerlink" title="4.7.6.启动canal"></a>4.7.6.启动canal</h5><p>/bin/startup.sh</p>
<p>jps   =&gt; CanalLauncher进程</p>
<p>如果起动不成功,排查问题参考</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.需要修改canal.properties配置，但是官网没有讲解。（大概率）进入canal解压文件 ，编辑conf&#x2F;canal.properties文件</span><br><span class="line">vim conf&#x2F;canal.properties</span><br><span class="line">有这么一行</span><br><span class="line">canal.instance.parser.parallelThreadSize &#x3D; 16</span><br><span class="line">默认是被注释掉的，需要打开注释,然后重启canal</span><br><span class="line">cd bin</span><br><span class="line">.&#x2F;restart.sh</span><br><span class="line">这种是第一次配置时，大概率碰到的情况。</span><br></pre></td></tr></table></figure>

<h5 id="4-7-6-测试"><a href="#4-7-6-测试" class="headerlink" title="4.7.6.测试"></a>4.7.6.测试</h5><p>参考地址:</p>
<p><a target="_blank" rel="noopener" href="https://github.com/alibaba/canal/wiki/QuickStart">https://github.com/alibaba/canal/wiki/QuickStart</a></p>
<p> <a target="_blank" rel="noopener" href="https://github.com/alibaba/canal/wiki/ClientExample">https://github.com/alibaba/canal/wiki/ClientExample</a> </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/11/01/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-ubuntu/" data-id="ckw60kwlk000cdugh8qhr166g" class="article-share-link">
        分享
      </a>
      
    </footer>

  </div>

  
  
<nav class="article-nav">
  
  <a href="/2018/11/19/flask-Python-%E7%BC%96%E5%86%99%E7%9A%84%E8%BD%BB%E9%87%8F%E7%BA%A7-Web-%E5%BA%94%E7%94%A8%E6%A1%86%E6%9E%B6/" class="article-nav-link">
    <strong class="article-nav-caption">前一篇</strong>
    <div class="article-nav-title">
      
      flask-python 编写的轻量级 Web 应用框架
      
    </div>
  </a>
  
  
  <a href="/2018/05/20/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0%E5%BB%BA%E8%AE%BE/" class="article-nav-link">
    <strong class="article-nav-caption">后一篇</strong>
    <div class="article-nav-title">数据中台建设</div>
  </a>
  
</nav>

  

  
  
  
  

</article>
</section>
    <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
  <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
  <li><i class="fe fe-bookmark"></i> <span id="busuanzi_value_page_pv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>个人博客 &copy; 2021</li>
      
        <li>ZHWANGART</li>
      
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>theme  <a target="_blank" rel="noopener" href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
  </div>
</footer>
  </main>
  <aside class="sidebar">
    <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/hexo.svg" alt="个人博客"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">Home</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">Archives</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/gallery">Gallery</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">About</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="搜索">
        <i class="fe fe-search"></i>
        搜索
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="fe fe-feed"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
  </aside>
  
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/copybtn.js"></script>





<script src="/js/tocbot.min.js"></script>

<script>
  // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
  tocbot.init({
    tocSelector: '.tocbot',
    contentSelector: '.article-entry',
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    hasInnerContainers: true,
    scrollSmooth: true,
    positionFixedSelector: '.tocbot',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
  });
</script>



<script src="/js/ocean.js"></script>

</body>

</html>